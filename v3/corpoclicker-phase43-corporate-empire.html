<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CorpoClicker Phase 4.3 - Corporate Empire</title>
    <!-- Embedded Manifest -->
    <script>
        // Embedded PWA Manifest
        if ('serviceWorker' in navigator) {
            const manifestData = {
                "name": "CorpoClicker Phase 4.3",
                "short_name": "CorpoClicker",
                "description": "Advanced Corporate Clicker Game - Global Empire Edition",
                "start_url": "./",
                "display": "standalone",
                "background_color": "#21808d",
                "theme_color": "#21808d",
                "orientation": "portrait-primary",
                "icons": [
                    {
                        "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%2321808d'/%3E%3Ctext x='50' y='60' text-anchor='middle' fill='white' font-size='40'%3Eüè¶%3C/text%3E%3C/svg%3E",
                        "sizes": "192x192",
                        "type": "image/svg+xml"
                    }
                ]
            };

            const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(manifestBlob);

            const link = document.createElement('link');
            link.rel = 'manifest';
            link.href = manifestURL;
            document.head.appendChild(link);
        }
    </script>
    <meta name="theme-color" content="#21808d">
    <style>
        /* PHASE 4.3 - MODERN UI SYSTEM WITH GLOBAL MARKETS */
        :root {
            /* Theme Colors */
            --primary: #21808d;
            --primary-light: #2d9aa8;
            --primary-dark: #1a6b75;

            /* Accent Colors */
            --accent-success: #4CAF50;
            --accent-warning: #FF9800;
            --accent-error: #F44336;
            --accent-info: #2196F3;
            --accent-purple: #9C27B0;

            /* Regional Colors */
            --region-europe: #3F51B5;
            --region-americas: #8BC34A;
            --region-asia: #FF5722;
            --region-africa: #795548;
            --region-middle-east: #607D8B;

            /* Currency Colors */
            --currency-usd: #4CAF50;
            --currency-eur: #2196F3;
            --currency-jpy: #FF5722;
            --currency-cny: #F44336;
            --currency-freight: #9C27B0;

            /* UI Colors */
            --background: #f8f9fa;
            --surface: #ffffff;
            --surface-alt: #f5f5f5;
            --text: #212121;
            --text-muted: #616161;
            --text-light: #9E9E9E;

            /* Shadows & Effects */
            --shadow-light: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 8px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 16px rgba(0,0,0,0.2);
            --blur-backdrop: blur(8px);

            /* Typography Scale (Reduced from 4.2.2) */
            --text-xs: 0.75rem;    /* 12px */
            --text-sm: 0.875rem;   /* 14px - new base */
            --text-base: 1rem;     /* 16px */
            --text-lg: 1.125rem;   /* 18px */
            --text-xl: 1.25rem;    /* 20px */
            --text-2xl: 1.5rem;    /* 24px */
            --text-3xl: 1.875rem;  /* 30px */

            /* Spacing Scale */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-12: 3rem;

            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            font-size: var(--text-sm);
            line-height: 1.5;
            background: var(--background);
            color: var(--text);
            overflow-x: hidden;
        }

        /* STICKY RESOURCE BAR - Always visible */
        .resource-bar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: var(--surface);
            backdrop-filter: var(--blur-backdrop);
            border-bottom: 1px solid #e0e0e0;
            padding: var(--space-3) var(--space-3);
            box-shadow: var(--shadow-medium);
			display: flex;
			align-items: center;
			gap: 16px;
        }
		.resource-grid-main {
			flex: 1;
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 16px;
		}

		.resource-bar-more {
			align-self: stretch;
			min-width: 80px;
			background: var(--primary-light, #2d9aa8);
			color: #fff;
			border: none;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			font-size: 1.1rem;
			margin-left: 8px;
		}

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--space-3);
            max-width: 1400px;
            margin: 0 auto;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-1);
            background: var(--surface-alt);
            border-radius: var(--radius-md);
            min-width: 0; /* Prevent flex overflow */
        }

        .resource-icon {
            font-size: var(--text-lg);
            flex-shrink: 0;
        }

        .resource-info {
            min-width: 0; /* Prevent flex overflow */
        }

        .resource-label {
            font-size: var(--text-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .resource-value {
            font-size: var(--text-base);
            font-weight: 700;
            font-family: ui-monospace, 'SF Mono', Consolas, monospace;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .resource-efficiency {
            font-size: var(--text-xs);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            margin-left: var(--space-2);
        }

        .efficiency-optimal { background: rgba(76, 175, 80, 0.2); color: #2E7D32; }
        .efficiency-moderate { background: rgba(255, 152, 0, 0.2); color: #E65100; }
        .efficiency-poor { background: rgba(244, 67, 54, 0.2); color: #C62828; }

        /* TAB SYSTEM - Modern Navigation */
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
        }

        .tab-navigation {
            background: var(--surface);
            border-bottom: 1px solid #e0e0e0;
            padding: 0 var(--space-4);
            overflow-x: auto;
        }

        .tab-list {
            display: flex;
            gap: 0;
            list-style: none;
            margin: 0;
            padding: 0;
            min-width: max-content;
        }

        .tab-button {
            background: none;
            border: none;
            padding: var(--space-4) var(--space-3);
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.2s ease;
            position: relative;
        }

        .tab-button:hover {
            color: var(--text);
            background: var(--surface-alt);
        }

        .tab-button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-button .tab-icon {
            margin-right: var(--space-2);
        }

        /* TAB CONTENT PANELS */
        .tab-content {
            display: none;
            padding: var(--space-6);
            animation: fadeIn 0.2s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* MAIN CLICK BUTTON - Prominent but compact */
        .main-action {
            text-align: center;
            padding: var(--space-3);
            border-bottom: 1px solid #e0e0e0;
        }

        .main-click-button {
            background: linear-gradient(135deg, #1877be, #21e1e1 60%, #ffcf4a);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-12);
            font-size: var(--text-lg);
            font-weight: 700;
            border-radius: var(--radius-xl);
            cursor: pointer;
            box-shadow: var(--shadow-medium);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .main-click-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-heavy);
        }

        .click-info {
            font-size: var(--text-sm);
            opacity: 0.9;
            margin-top: var(--space-1);
            text-transform: none;
            letter-spacing: normal;
        }

		/*Tooltip na karcie */
		.tooltip-icon {
		  display: inline-block;
		  background: #e0ecff;
		  color: #444;
		  border-radius: 50%;
		  width: 22px;
		  height: 22px;
		  text-align: center;
		  line-height: 22px;
		  cursor: pointer;
		  margin-left: 8px;
		  position: relative;
		  font-size: 15px;
		  border: 1.5px solid #b7d2fa;
		  transition: background .2s;
		}
		.tooltip-icon:hover, .tooltip-icon:focus {
		  background: #c8e3ff;
		  outline: none;
		}
.tooltip-text {
  visibility: hidden;
  opacity: 0;
  max-width: 320px;
  width: max-content;
  background-color: #fff;
  color: #365;
  font-size: 13px;
  text-align: left;
  border-radius: 9px;
  border: 1px solid #ddd;
  padding: 14px;
  position: absolute;
  z-index: 9999;
  left: 50%;
  top: 110%;
  transform: translateX(-50%);
  box-shadow: 0 2px 16px rgba(60,86,112,.18);
  transition: .18s opacity;
  word-break: break-word;
  overflow-wrap: break-word;
  /* Zabezpiecza przed wyj≈õciem poza ekran */
}

.tooltip-icon:hover .tooltip-text,
.tooltip-icon:focus .tooltip-text {
  visibility: visible;
  opacity: 1;
}

/* Responsywnie na wƒÖskich ekranach */
@media (max-width: 700px) {
  .tooltip-text {
    max-width: 95vw;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
  }
}

        /* MODERN CARD SYSTEM */
        .card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-light);
            overflow: visible !important;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-2px);
        }

        .card-header {
            padding: var(--space-2) var(--space-2);
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .card-content {
            padding: var(--space-3);
        }

        /* GRID LAYOUTS - Responsive */
        .grid {
            display: grid;
            gap: var(--space-5);
        }

        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-auto { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }

        /* GLOBAL REGIONS SYSTEM */
        .region-card {
            position: relative;
            overflow: hidden;
        }

        .region-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        .region-header {
            background: linear-gradient(135deg, var(--region-europe), transparent);
            padding: var(--space-4);
            color: white;
            position: relative;
        }

        .region-card[data-region="americas"] .region-header {
            background: linear-gradient(135deg, var(--region-americas), transparent);
        }

        .region-card[data-region="asia"] .region-header {
            background: linear-gradient(135deg, var(--region-asia), transparent);
        }

        .region-card[data-region="africa"] .region-header {
            background: linear-gradient(135deg, var(--region-africa), transparent);
        }

        .region-card[data-region="middle-east"] .region-header {
            background: linear-gradient(135deg, var(--region-middle-east), transparent);
        }

        .region-title {
            font-size: var(--text-xl);
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .region-status {
            font-size: var(--text-sm);
            opacity: 0.9;
            margin-top: var(--space-1);
        }

        .region-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-3);
            margin-top: var(--space-4);
        }

        .stat-item {
            text-align: center;
            background: var(--surface-alt);
            border-radius: var(--radius-md);
        }

        .stat-label {
            font-size: var(--text-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .stat-value {
            font-size: var(--text-base);
            font-weight: 500;
            color: var(--primary);
            font-family: ui-monospace, 'SF Mono', Consolas, monospace;
            margin-top: var(--space-1);
        }
		.human-capital-panel {
		  background: #f9f9ff;
		  border-radius: 14px;
		  padding: 24px;
		  box-shadow: 0 2px 18px rgba(33,64,128,0.08);
		  margin-bottom: 32px;
		}
		.stress-label, .motivation-label { font-weight: bold; padding: 2px 9px; border-radius: 8px; }
		.stress-label.green { background: #c8e6c9; color: #2e7d32; }
		.stress-label.yellow { background: #fff9c4; color: #fbc02d; }
		.stress-label.red { background: #ffcdd2; color: #c62828; }
		.tip { display: block; color: #1976d2; margin-top: 6px; font-size: 13px;}
		.effect-table th { background: #e3e3fa; font-weight: bold; }
		.effect-table td { padding: 3px 10px; }
        /* COFFEE BUTTON*/
		.coffee-action-btn {
		  background: linear-gradient(90deg, #ffe082 0%, #ffee58 50%, #8bc34a 100%);
		  color: #444;
		  font-weight: bold;
		  border: none;
		  outline: none;
		  border-radius: 15px;
		  box-shadow: 0 2px 8px #ccc2;
		  padding: 7px 28px 7px 18px;
		  margin: 8px 0 0 0;
		  font-size: 16px;
		  position: relative;
		  cursor: pointer;
		  transition: background .18s, box-shadow .18s, color .18s;
		  display: inline-flex;
		  align-items: center;
		  gap: 6px;
		}
		.coffee-action-btn[disabled] {
		  background: #eee;
		  color: #888;
		  box-shadow: none;
		  cursor: not-allowed;
		}

		/* FX TRADING SYSTEM */
        .fx-ticker {
            background: linear-gradient(135deg, #1e3a5f, #2c5282);
            color: white;
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-4);
        }

        .fx-title {
            font-size: var(--text-lg);
            font-weight: 700;
            margin-bottom: var(--space-3);
            text-align: center;
        }

        .fx-pairs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-3);
        }

        .fx-pair {
            text-align: center;
            padding: var(--space-3);
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .fx-pair:hover {
            background: rgba(255,255,255,0.2);
        }

        .fx-pair-name {
            font-size: var(--text-sm);
            font-weight: 600;
            margin-bottom: var(--space-1);
        }

        .fx-rate {
            font-size: var(--text-base);
            font-family: ui-monospace, 'SF Mono', Consolas, monospace;
            font-weight: 700;
        }

        .fx-trend {
            font-size: var(--text-xs);
            margin-top: var(--space-1);
        }

        .trend-up { color: #4CAF50; }
        .trend-down { color: #F44336; }
        .trend-stable { color: #FFC107; }

        /* AI AUTOMATION PANEL */
        .automation-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: var(--radius-lg);
            padding: var(--space-5);
        }

        .automation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .automation-title {
            font-size: var(--text-xl);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .automation-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .automation-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .automation-toggle.active {
            background: rgba(76, 175, 80, 0.3);
        }

        .ai-agents {
            display: grid;
            gap: var(--space-3);
        }

        .ai-agent {
            background: rgba(255,255,255,0.1);
            padding: var(--space-4);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .agent-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .agent-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }

        .agent-status.inactive {
            background: #757575;
            box-shadow: none;
        }

        /* DEPARTMENT SYSTEM - Enhanced for Global Operations */
        .department-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--space-4);
        }

        .department-card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-light);
            overflow: visible !important;
            transition: all 0.3s ease;
        }

        .department-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .department-card.locked {
            opacity: 0.6;
            pointer-events: none;
        }

        .department-header {
            padding: var(--space-2);
            background: linear-gradient(135deg, rgba(33, 128, 141, 0.1), transparent);
            border-bottom: 1px solid #f0f0f0;
        }

        .department-title {
            font-size: var(--text-lg);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .department-description {

			font-weight: 500;
            color: var(--text-muted);

        }

        .department-body {
            padding: var(--space-3);
			overflow: visible !important;
        }

        .department-effects {
            background: rgba(33, 128, 141, 0.05);
            padding: var(--space-1);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-1);
            border-left: 3px solid var(--primary);
        }

        .effects-title {
            font-size: var(--text-xs);
            font-weight: 300;
            color: var(--primary);
            margin-bottom: var(--space-1);
            text-transform: uppercase;
        }

        .effect-item {
            font-size: var(--text-xs);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .effect-positive { color: var(--accent-success); }
        .effect-negative { color: var(--accent-error); }

        .department-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-1);
            margin-bottom: var(--space-2);
			overflow: visible !important;
        }

        .department-button {
            background: linear-gradient(135deg, var(--accent-success), #66BB6A);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-2);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .department-button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }

        .department-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* PROGRESS BARS - Compact Design */
        .progress-container {
            background: #e8f4f8;
            border-radius: 12px;
            height: 24px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--text-xs);
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            transition: all 0.5s ease;
        }

        .progress-fill.stress {
            background: linear-gradient(90deg, #4CAF50, #FF9800, #F44336);
        }

        .progress-fill.motivation {
            background: linear-gradient(90deg, #F44336, #FF9800, #4CAF50);
        }
        /* NOTIFICATIONS - Modern Toast System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-4) var(--space-5);
            box-shadow: var(--shadow-heavy);
            z-index: 10000;
            max-width: 400px;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid var(--primary);
            backdrop-filter: var(--blur-backdrop);
        }

        .notification.success { border-left-color: var(--accent-success); }
        .notification.warning { border-left-color: var(--accent-warning); }
        .notification.error { border-left-color: var(--accent-error); }
        .notification.info { border-left-color: var(--accent-info); }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            .resource-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tab-button {
                padding: var(--space-3) var(--space-4);
                font-size: var(--text-xs);
            }

            .tab-content {
                padding: var(--space-4);
            }

            .grid-3 {
                grid-template-columns: 1fr;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .department-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .fx-pairs {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            :root {
                --text-xs: 0.7rem;
                --text-sm: 0.8rem;
                --text-base: 0.9rem;
            }

            .resource-grid {
                grid-template-columns: 1fr;
            }

            .tab-navigation {
                padding: 0 var(--space-2);
            }

            .tab-button {
                padding: var(--space-2) var(--space-3);
            }
        }

        /* UTILITY CLASSES */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }

        .font-mono { font-family: ui-monospace, 'SF Mono', Consolas, monospace; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 600; }

        .text-success { color: var(--accent-success); }
        .text-warning { color: var(--accent-warning); }
        .text-error { color: var(--accent-error); }
        .text-muted { color: var(--text-muted); }

        .mb-2 { margin-bottom: var(--space-2); }
        .mb-3 { margin-bottom: var(--space-3); }
        .mb-4 { margin-bottom: var(--space-4); }
        .mb-6 { margin-bottom: var(--space-6); }

        .hidden { display: none; }
        .invisible { visibility: hidden; }

        /* LOADING STATES */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
		/* ========== ACHIEVEMENT SYSTEM STYLES ========== */
.achievement-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 800px;
    max-height: 80vh;
    background: var(--surface);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-heavy);
    z-index: 10000;
    display: none;
    flex-direction: column;
    backdrop-filter: var(--blur-backdrop);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.achievement-panel.show {
    display: flex;
    animation: achievement-panel-in 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes achievement-panel-in {
    from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

.achievement-header {
    padding: var(--space-6);
    border-bottom: 1px solid rgba(224, 224, 224, 0.5);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
}

.achievement-title {
    font-size: var(--text-2xl);
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: var(--space-3);
}

.achievement-progress-summary {
    font-size: var(--text-sm);
    opacity: 0.9;
}

.achievement-close {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    padding: var(--space-2);
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: var(--text-lg);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.achievement-close:hover {
    background: rgba(255, 255, 255, 0.3);
}

.achievement-content {
    flex: 1;
    overflow-y: auto;
    padding: var(--space-6);
}

.achievement-filters {
    display: flex;
    gap: var(--space-2);
    margin-bottom: var(--space-6);
    flex-wrap: wrap;
}

.filter-btn {
    padding: var(--space-2) var(--space-4);
    border: 2px solid var(--primary);
    background: transparent;
    color: var(--primary);
    border-radius: var(--radius-md);
    cursor: pointer;
    font-weight: 600;
    font-size: var(--text-sm);
    transition: all 0.2s ease;
}

.filter-btn.active,
.filter-btn:hover {
    background: var(--primary);
    color: white;
}

.achievement-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--space-4);
}

.achievement-item {
    background: var(--surface-alt);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    border: 2px solid transparent;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.achievement-item:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-medium);
}

.achievement-item.unlocked {
    border-color: var(--accent-success);
    background: rgba(76, 175, 80, 0.05);
}

.achievement-item.locked {
    opacity: 0.7;
}

.achievement-item-header {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    margin-bottom: var(--space-3);
}

.achievement-icon {
    font-size: var(--text-3xl);
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-md);
    background: rgba(255, 255, 255, 0.8);
    flex-shrink: 0;
}

.achievement-info {
    flex: 1;
}

.achievement-name {
    font-weight: 700;
    font-size: var(--text-lg);
    margin-bottom: var(--space-1);
    color: var(--text);
}

.achievement-tier {
    padding: 2px 8px;
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.tier-bronze {
    background: rgba(205, 127, 50, 0.2);
    color: #8B4513;
}

.tier-silver {
    background: rgba(192, 192, 192, 0.3);
    color: #696969;
}

.tier-gold {
    background: rgba(255, 215, 0, 0.3);
    color: #B8860B;
}

.tier-platinum {
    background: rgba(229, 228, 226, 0.4);
    color: #4A4A4A;
}

.achievement-description {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-bottom: var(--space-3);
    line-height: 1.4;
}

.achievement-reward {
    background: rgba(76, 175, 80, 0.1);
    border-radius: var(--radius-md);
    padding: var(--space-2) var(--space-3);
    font-size: var(--text-xs);
    color: var(--accent-success);
    font-weight: 600;
    border-left: 3px solid var(--accent-success);
}

.achievement-no-reward {
    font-size: var(--text-xs);
    color: var(--text-light);
    font-style: italic;
}

.achievement-unlock-indicator {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
}

.achievement-item.unlocked .achievement-unlock-indicator {
    background: var(--accent-success);
    color: white;
}

.achievement-item.locked .achievement-unlock-indicator {
    background: var(--text-light);
    color: white;
}

.achievement-progress-bar {
    width: 100%;
    height: 6px;
    background: rgba(224, 224, 224, 0.5);
    border-radius: 3px;
    overflow: hidden;
    margin-top: var(--space-2);
}

.achievement-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--primary-light));
    border-radius: 3px;
    transition: width 0.3s ease;
}

.achievement-notification {
    position: fixed;
    top: 80px;
    right: 20px;
    background: linear-gradient(135deg, var(--accent-success), #66BB6A);
    color: white;
    padding: var(--space-4) var(--space-5);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-heavy);
    z-index: 10001;
    display: flex;
    align-items: center;
    gap: var(--space-3);
    min-width: 300px;
    animation: achievement-notification-in 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes achievement-notification-in {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.achievement-notification-icon {
    font-size: var(--text-2xl);
    background: rgba(255, 255, 255, 0.2);
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
}

.achievement-notification-content {
    flex: 1;
}

.achievement-notification-title {
    font-weight: 700;
    font-size: var(--text-base);
    margin-bottom: var(--space-1);
}

.achievement-notification-desc {
    font-size: var(--text-sm);
    opacity: 0.9;
}

.achievement-progress-indicator {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.95);
    padding: var(--space-2) var(--space-4);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-light);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--primary);
    z-index: 1001;
    display: flex;
    align-items: center;
    gap: var(--space-2);
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: var(--blur-backdrop);
}

.achievement-progress-indicator:hover {
    background: rgba(255, 255, 255, 1);
    box-shadow: var(--shadow-medium);
}

.achievement-progress-icon {
    font-size: var(--text-base);
}

@media (max-width: 768px) {
    .achievement-panel {
        width: 95%;
        max-height: 90vh;
    }

    .achievement-grid {
        grid-template-columns: 1fr;
    }

    .achievement-filters {
        justify-content: center;
    }

    .achievement-notification {
        right: 10px;
        min-width: 280px;
    }
}

@media (max-width: 480px) {
    .achievement-header {
        padding: var(--space-4);
    }

    .achievement-content {
        padding: var(--space-4);
    }

    .achievement-title {
        font-size: var(--text-xl);
    }

    .achievement-notification {
        right: 5px;
        min-width: 260px;
    }
}
.market-upgrade-btn {
    display: inline-block;
    padding: 10px 22px;
    margin: 14px auto 0 auto;
    font-size: 1rem;
    font-weight: 700;
    color: #fff;
    background: linear-gradient(90deg, #2180ed 0%, #52c3d8 100%);
    border-radius: 24px;
    border: none;
    box-shadow: 0 4px 16px rgba(33,128,237,0.12);
    cursor: pointer;
    transition: background 0.3s, box-shadow 0.3s, transform 0.1s;
    outline: none;
    letter-spacing: 0.3px;
}
.market-upgrade-btn:hover, .market-upgrade-btn:active, .market-upgrade-btn:focus {
    background: linear-gradient(90deg, #1976d2 0%, #26b8cd 100%);
    transform: translateY(-1px) scale(1.04);
    box-shadow: 0 8px 32px rgba(33,128,237,0.18);
}
.market-upgrade-btn:disabled {
    opacity: 0.65;
    filter: grayscale(0.7);
    cursor: not-allowed;
    background: #b0bec5;
    color: #fff;
    box-shadow: none;
}
.expansion-progress-fancy { font-weight:600; display:flex; align-items:center; gap:8px; }
.progress-shell { position: relative; width: 120px; height: 8px; background: #e0e6ef; border-radius: 8px; display: inline-block; margin: 0 8px;}
.progress-bar { height: 100%; border-radius: 8px; background: linear-gradient(90deg,#52c3d8 0%,#2196f3 100%); transition: width 0.7s cubic-bezier(.21,.9,.47,1.45);}
.progress-flare { position: absolute; right:-14px; top:-7px; width:22px; height:22px; background: url('https://cdn-icons-png.flaticon.com/512/148/148841.png') no-repeat center/contain; pointer-events:none;}
.fancy-map { margin:10px 0 0 0; }
.fancy-region-stats span {padding:2px 8px;border-radius:12px;margin-right:4px}
.fancy-region-stats .active {background:rgba(33,150,243,0.09);color:#1565c0;font-weight:600;}
.fancy-region-stats .locked {text-decoration:line-through;color:#bdbdbd;}
@media (max-width:480px) {
 .global-map-visual svg { width:99vw!important; height:auto;}
 .progress-shell {width:80px;}
}
.region-list-clean {
  margin: 12px 0;
  max-width: 380px;
}
.region-row {
  display: flex;
  align-items: center;
  padding: 6px 0;
  border-bottom: 1px solid #f2f3f8;
  font-size: 15px;
  gap: 18px;
  transition: color .25s;
}
.region-row.unlocked {
  color: #1565c0;
  font-weight: 600;
}
.region-row.locked {
  color: #bdbdbd;
  font-style: italic;
}
.region-flag { font-size: 21px; margin-right: 4px;}
.region-info {margin-left: auto; font-size:14px;}
.region-name {min-width:90px;}
.game-popup {
  position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; z-index: 9999;
  background: rgba(30,40,50,0.30); display: flex; align-items: center; justify-content: center;
}
.game-popup.hidden { display: none; }
.popup-content {
  background: #fff; padding: 36px 32px 28px 32px; border-radius: 18px;
  min-width: 340px; text-align: center; box-shadow: 0 4px 42px rgba(33,80,130,0.18);
  font-size: 17px; color: #1a2b3c;
}
#custom-modal {
  display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
  z-index: 600;
  align-items: center; justify-content: center;
}
.modal-overlay {
  position: absolute; width: 100vw; height: 100vh; background: rgba(60,80,120,0.24); left:0; top:0;
}
.modal-box {
  position: relative; background: #fff; border-radius: 20px; padding: 32px 28px 24px 28px;
  min-width: 240px; text-align: center; box-shadow: 0 8px 32px rgba(40,60,80,0.11);
}
.modal-message {
  font-size: 1.18em; margin-bottom: 18px;
}
.modal-btn {
  background: linear-gradient(90deg,#ffe082,#c5e1a5);
  border:none; outline:none; color:#2a2a2a; font-weight:bold; padding: 10px 34px; border-radius:16px; cursor:pointer;
  box-shadow:0 2px 8px #e0e1e6;
  font-size: 1.1em;
  transition: background 0.2s;
}
.modal-btn:hover {
  background: linear-gradient(90deg,#c5e1a5,#ffe082);
}
.documents-panel {
  margin: 32px auto 36px auto;
  max-width: 480px;
  background: linear-gradient(120deg, #f6fafd 65%, #e4f0f7 100%);
  border-radius: 22px;
  box-shadow: 0 6px 24px rgba(44, 62, 112, 0.15), 0 1.5px 10px rgba(33,128,237,0.08);
  border: 1px solid #e4eef6;
  padding: 32px 36px 34px 36px;
  text-align: left;
  overflow: hidden;
}
.documents-btn-desc {
  display: block;
  font-weight: 400;
  font-size: 0.98em;
  color: #e3f7fc;
  letter-spacing: 0.01em;
  margin-top: 2px;
}
.documents-panel h3 {
  font-size: 1.29em;
  color: #145584;
  margin-top: 0;
  margin-bottom: 20px;
  letter-spacing: 0.6px;
  font-weight: 800;
  text-shadow: 0 1px 0 #fff7, 0 2px 16px #c2e6fc60;
}

.documents-actions {
  display: flex;
  flex-direction: column;
  gap: 19px;
  margin-bottom: 19px;
}

.documents-panel button {
  display: block;
  padding: 13px 0;
  width: 100%;
  font-size: 1.08em;
  font-weight: 700;
  color: #fff;
  background: linear-gradient(90deg, #2196f3 5%, #43c6db 100%);
  border-radius: 21px;
  border: none;
  box-shadow: 0 3px 13px rgba(64,176,246,0.13);
  cursor: pointer;
  transition: background 0.22s, box-shadow 0.22s, transform 0.11s;
  outline: none;
  letter-spacing: 0.2px;
  margin: 0;
  margin-bottom: 0;
  line-height: 1.25;
}

.documents-panel button:hover,
.documents-panel button:active,
.documents-panel button:focus {
  background: linear-gradient(90deg, #1976d2 0, #26b8cd 100%);
  transform: translateY(-2px) scale(1.045);
  box-shadow: 0 8px 32px rgba(33,128,237,0.16);
}

.documents-panel button:disabled {
  opacity: 0.60;
  filter: grayscale(0.7);
  cursor: not-allowed;
  background: #b0bec5;
  color: #fff;
  box-shadow: none;
}

.documents-panel-feedback {
  margin-top: 17px;
  padding: 13px 17px;
  font-size: 1.01em;
  background: linear-gradient(90deg, #eaf5fc 60%, #e0eff8 100%);
  color: #16717e;
  border-radius: 13px;
  min-height: 20px;
  border: 1px solid #c2e6fc;
  box-shadow: 0 1.5px 7px rgba(67, 198, 219, 0.09);
  font-weight: 600;
  letter-spacing: 0.02em;
}

@media (max-width: 700px) {
  .documents-panel {
    padding: 17px 5vw 17px 5vw;
    max-width: 99vw;
  }
  .documents-panel h3 {
    font-size: 1.09em;
  }
  .documents-panel-feedback {
    font-size: 0.96em;
    padding: 8px 6px;
  }
}
.modern-title {
    font-size: var(--text-3xl);
    font-weight: 800;
    background: linear-gradient(135deg, #1877be, #21e1e1 60%, #ffcf4a);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 4px;
}
.modern-title .ver {
    font-size: 0.6em;
    font-weight: 700;
    margin-left: 8px;
    vertical-align: top;
    background: linear-gradient(90deg, #ffcf4a 35%, #21e1e1 65%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
    </style>
</head>
<body>
<!-- STICKY RESOURCE BAR - Always Visible -->
<div class="resource-bar">
    <div class="resource-grid resource-grid-main">
        <!-- Core Resources (widoczne ca≈Çy czas) -->
        <div class="resource-item">
            <div class="resource-icon">üí∞</div>
            <div class="resource-info">
                <div class="resource-label">Bud≈ºet</div>
                <div class="resource-value" id="budget">100</div>
            </div>
            <div class="resource-efficiency efficiency-optimal" id="budget-efficiency">100%</div>
			<span class="tooltip-icon" tabindex="0">?
  <span class="tooltip-text">
    Ten surowiec korzysta z <b>softcap√≥w</b>:
    <br>‚Ä¢ Poni≈ºej prog√≥w warto≈õƒá ro≈õnie 100% efektywnie
    <br>‚Ä¢ Powy≈ºej prog√≥w ‚Äî coraz wolniej (diminishing returns)
    <br><br>
    <b>Resource efficiency</b> pokazuje % wydajno≈õci pozyskiwania.
  </span>
</span>

        </div>
        <div class="resource-item">
            <div class="resource-icon">üìÑ</div>
            <div class="resource-info">
                <div class="resource-label">Dokumenty</div>
                <div class="resource-value" id="documents">0</div>
            </div>
            <div class="resource-efficiency efficiency-optimal" id="documents-efficiency">100%</div>
			<span class="tooltip-icon" tabindex="0">?
  <span class="tooltip-text">
    <b>Efektywno≈õƒá surowca:</b> pokazuje, z jakƒÖ skuteczno≈õciƒÖ aktualnie pozyskujesz ten zas√≥b.<br>
    ‚Ä¢ 100%: pe≈Çna efektywno≈õƒá (poni≈ºej softcapu)<br>
    ‚Ä¢ 70%: zbli≈ºasz siƒô do limitu <br>
    ‚Ä¢ 40%: warto rozwinƒÖƒá nowƒÖ produkcjƒô lub inwestowaƒá w inne zasoby!
  </span>
</span>
        </div>
        <div class="resource-item">
            <div class="resource-icon">‚òï</div>
            <div class="resource-info">
                <div class="resource-label">Kawa</div>
                <div class="resource-value" id="coffee">0</div>
            </div>
            <div class="resource-efficiency efficiency-optimal" id="coffee-efficiency">100%</div>
			<span class="tooltip-icon" tabindex="0">?
  <span class="tooltip-text">
    <b>Kawa:</b> kluczowy nap√≥j w korpo!<br>
    U≈ºywaj, by zmniejszaƒá stres i podnosiƒá motywacjƒô.<br>
    Poziom kawy wp≈Çywa na resource efficiency: im wiƒôcej, tym mniejszy przyrost.
  </span>
</span>
        </div>
        <div class="resource-item">
            <div class="resource-icon">üéñÔ∏è</div>
            <div class="resource-info">
                <div class="resource-label">Presti≈º</div>
                <div class="resource-value" id="prestige">0</div>
            </div>
            <div class="resource-efficiency efficiency-optimal" id="prestige-efficiency">100%</div>
        </div>
    </div>
    <!-- Przycisk rozwijania -->
    <button class="resource-bar-more" onclick="toggleResourceBarExtra()">+</button>
    <!-- Pozosta≈Çe zasoby -->
    <div class="resource-grid resource-bar-extra" style="display: none;">
        <div class="resource-item">
            <div class="resource-icon">üíµ</div>
            <div class="resource-info">
                <div class="resource-label">USD</div>
                <div class="resource-value" id="usd">0</div>
            </div>
        </div>
        <div class="resource-item">
            <div class="resource-icon">üí∂</div>
            <div class="resource-info">
                <div class="resource-label">EUR</div>
                <div class="resource-value" id="eur">0</div>
            </div>
        </div>
        <div class="resource-item">
            <div class="resource-icon">üí¥</div>
            <div class="resource-info">
                <div class="resource-label">JPY</div>
                <div class="resource-value" id="jpy">0</div>
            </div>
        </div>
        <div class="resource-item">
            <div class="resource-icon">üí∑</div>
            <div class="resource-info">
                <div class="resource-label">CNY</div>
                <div class="resource-value" id="cny">0</div>
            </div>
        </div>
        <div class="resource-item">
            <div class="resource-icon">üì¶</div>
            <div class="resource-info">
                <div class="resource-label">Freight</div>
                <div class="resource-value" id="freight">0</div>
            </div>
        </div>
    </div>
</div>

    <!-- MAIN GAME CONTAINER -->
    <div class="game-container">
        <!-- GAME HEADER -->
        <div class="main-action">
<h1 class="modern-title">
    üöÄ Korposzczur <span class="ver">v0.4.5</span>
    <span>Economy Incremental Idle</span>
</h1>

            <button class="main-click-button" id="main-click-button">
                üíº Kliknij, aby zwiƒôkszyƒá bud≈ºet
                <div class="click-info">
                    +<span id="click-value">2</span> doüí∞ ‚Ä¢ Twoja praca ma aktualnie <span id="click-efficiency">100%</span> efektywno≈õci
                </div>
            </button>
        </div>

        <!-- TAB NAVIGATION -->
        <nav class="tab-navigation">
            <ul class="tab-list" role="tablist">
                <li role="presentation">
                    <button class="tab-button active" id="tab-overview" onclick="switchTab('overview')" role="tab">
                        <span class="tab-icon">üìä</span>
                        PrzeglƒÖd
                    </button>
                </li>
				<li role="presentation">
                    <button class="tab-button" id="tab-dokuments" onclick="switchTab('documents')" role="tab">
                        <span class="tab-icon">üìÑ</span>
                        Centrum Dokument√≥w
                    </button>
                </li>
                <li role="presentation">
                    <button class="tab-button" id="tab-human-capital" onclick="switchTab('human-capital')" role="tab">
                        <span class="tab-icon">‚öñÔ∏è</span>
                        Kapita≈Ç Ludzki
                    </button>
                </li>
                <li role="presentation">
                    <button class="tab-button" id="tab-global-markets" onclick="switchTab('global-markets')" role="tab">
                        <span class="tab-icon">üåç</span>
                        Rynki Globalne
                    </button>
                </li>
                <li role="presentation">
                    <button class="tab-button" id="tab-trade" onclick="switchTab('trade')" role="tab">
                        <span class="tab-icon">üí±</span>
                        Handel
                    </button>
                </li>
                <li role="presentation">
                    <button class="tab-button" id="tab-automation" onclick="switchTab('automation')" role="tab">
                        <span class="tab-icon">ü§ñ</span>
                        Automatyzacja
                    </button>
                </li>
                <li role="presentation">
                    <button class="tab-button" id="tab-minigames" onclick="switchTab('minigames')" role="tab">
                        <span class="tab-icon">üéÆ</span>
                        Rozrywka
                    </button>
                </li>
				<li role="presentation">
				  <button class="tab-button" id="tab-achievements" onclick="openAchievementPanel()" role="tab">
					<span class="tab-icon">üèÜ</span>
					<span id="achievement-progress-text">0/30 (0%)</span>
				  </button>
				</li>
            </ul>
        </nav>

        <!-- TAB CONTENT PANELS -->

        <!-- OVERVIEW TAB -->
        <div class="tab-content active" id="overview-content">
            <div class="grid grid-auto">
                <!-- Company Overview Card -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üè¢</span>
                            Imperium Korporacyjne
                        </h2>
                    </div>
                    <div class="card-content">
                        <div class="department-grid" id="departments-overview">
                            <!-- Departments will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Global Presence Card 
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üåç</span>
                            Obecno≈õƒá Globalna
                        </h2>
                    </div>
						<div class="card-content">
							<div class="region-stats">
								<div class="stat-item">
									<div class="stat-label">AKTYWNE REGIONY</div>
									<div class="stat-value" id="active-regions">1</div>
								</div>
								<div class="stat-item">
									<div class="stat-label">CA≈ÅKOWITE PRZYCHODY</div>
									<div class="stat-value" id="total-revenue">100</div>
								</div>
								<div class="stat-item">
									<div class="stat-label">GLOBALNY POZIOM</div>
									<div class="stat-value" id="global-level">1</div>
								</div>
							</div>
							<div class="expansion-progress-fancy" style="margin:10px 0 4px 0;">
								<span>Progres ekspansji:</span>
								<div class="progress-shell">
									<div class="progress-bar" id="expansion-bar"></div>
									<div class="progress-flare" id="expansion-flare" style="display:none"></div>
								</div>
								<span id="expansion-progress-value">1/4</span>
							</div>
							<div id="global-presence-card"></div>
							<div class="region-list-clean"></div>
							<div class="fancy-region-stats" style="margin-top:12px; font-size:14px;" id="fancy-region-stats"></div>
						</div>
                </div>-->
            </div>
        </div>
<div class="documents-panel tab-content" id="documents-content">
  <h3>Centrum dokument√≥w</h3>
  <div class="documents-actions">
    <!-- 1. Konwersja dokument√≥w na bud≈ºet -->
    <button onclick="game.convertDocumentsToBudget()">
      üíº Zrealizuj kontrakty<br>
      <span class="documents-btn-desc">Wydaj <b>100 dokument√≥w</b>, zyskaj <b>2000$</b></span>
    </button>
    <!-- 2. Automatyzacja HR -->
    <button onclick="game.unlockHrAutomation()">
      ‚öôÔ∏è Automatyzuj HR<br>
      <span class="documents-btn-desc">Wydaj <b>3000 dokument√≥w</b></span>
    </button>
    <!-- 3. Automatyzacja Dzia≈Çu Dokument√≥w -->
    <button onclick="game.upgradeDocsDepartment()">
      üìë Upgrade Dzia≈Çu Dokument√≥w<br>
      <span class="documents-btn-desc">Wydaj <b>5000 dokument√≥w</b></span>
    </button>
    <!-- 4. Badania R&D -->
    <button onclick="game.researchDocsProcedure()">
      üß™ Badania R&D<br>
      <span class="documents-btn-desc">Wydaj <b>7000 dokument√≥w</b> na losowy bonus</span>
    </button>
  </div>
  <div id="documents-panel-feedback" class="documents-panel-feedback"></div>
</div>

        <!-- HUMAN CAPITAL TAB -->
<div class="tab-content" id="human-capital-content">
  <div class="info-instructions" style="margin-bottom: 18px; background: #e8f4ff; border-radius: 12px; padding: 16px;">
    <h3>Jak zarzƒÖdzaƒá Kapita≈Çem Ludzkim?<span class="tooltip-icon" tabindex="0">?
  <span class="tooltip-text" style="max-width:340px;">
    <b>Jak kapita≈Ç ludzki wp≈Çywa na grƒô?</b><br><br>
    <u>Stres</u> i <u>motywacja</u> zespo≈Çu wp≈ÇywajƒÖ na:
    <br>‚Ä¢ <b>Produkcjƒô Bud≈ºetu</b> (<span style="color:#016;">üí∞</span>), <b>Dokument√≥w</b> (<span style="color:#163;">üìÑ</span>), <b>Kawy</b> (<span style="color:#834;">‚òï</span>) i <b>Presti≈ºu</b> (<span style="color:#c58;">üéñÔ∏è</span>)
    <br>‚Ä¢ Tempo przyrostu tych zasob√≥w (ticki gry, automaty, klikniƒôcia)
    <br><br>
    Im wy≈ºsza motywacja zespo≈Çu, tym wiƒôcej mo≈ºesz wyprodukowaƒá w ka≈ºdej akcji!
    Im wiƒôkszy stres, tym wolniej pracujƒÖ wszystkie dzia≈Çy, a ryzyko strat i wypalenia ro≈õnie.
    <br><br>
    <i>Kapita≈Ç ludzki = globalny mno≈ºnik dla wszystkich g≈Ç√≥wnych zasob√≥w w firmie</i>
  </span>
</span></h3>
	
    <ul style="font-size: 1em; line-height: 1.6; margin-bottom: 7px; padding:4px">
      <li>Stres <strong>poni≈ºej 50</strong> = wysoka jako≈õƒá i produkcja, ma≈Çe ryzyko rezygnacji.</li>
      <li>Motywacja <strong>powy≈ºej 50</strong> = bonusy do tempa i produkcji!</li>
      <li>
        <span style="color: #1976d2;"><b>Tip:</b></span> U≈ºyj kawy lub zatrudnij w HR, gdy stres ro≈õnie. Organizuj eventy, gdy motywacja spada.
      </li>
    </ul>
  </div>
  <div class="grid">
    <!-- Stress Management -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">
          <span>üò∞</span> Poziom Stresu Korporacyjnego
<span class="tooltip-icon" tabindex="0">?
  <span class="tooltip-text">
    Poziomy stresu:<br>
    0‚Äì25 ‚Äî OK<br>
    26‚Äì50 ‚Äî -5% produkcji, -10% jako≈õci<br>
    51‚Äì75 ‚Äî -15% produkcji, -25% jako≈õci<br>
    76‚Äì100 ‚Äî -30% produkcji, -50% jako≈õci<br>
    100+ ‚Äî Coraz gorzej, ryzyko burnout!
  </span>
</span>
        </h2>
        <div class="font-mono"><span id="stress">0</span> / 200</div>
      </div>
      <div class="card-content">
        <div class="progress-container">
          <div class="progress-fill stress" id="stress-progress" style="width: 0%">
            <span id="stress-percentage">0%</span>
          </div>
        </div>
        <div id="stress-effects"
          style="margin-top: var(--space-3); padding: var(--space-3); background: rgba(244,67,54,0.07); border-radius: var(--radius-md); border-left: 3px solid var(--accent-error); color: #C62828; font-size: var(--text-sm);">
          Produkcja: 100% ‚Ä¢ Jako≈õƒá: 100% ‚Ä¢ Ryzyko rezygnacji: 0%
        </div>
      </div>
    </div>
    <!-- Motivation Management -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">
          <span>üí™</span> Motywacja Zespo≈Çu
          <span class="tooltip-icon" tabindex="0">?
            <span class="tooltip-text">
              Motywacja daje dodatkowe bonusy:<br>
              <table style="margin-top:6px;">
                <tr><td>&lt;25</td><td>-25% produkcji, zwolnienia</td></tr>
                <tr><td>25‚Äì50</td><td>Brak premii</td></tr>
                <tr><td>51‚Äì75</td><td>+15% produkcji</td></tr>
                <tr><td>&gt;75</td><td>+30% produkcji, szybkie tempo</td></tr>
              </table>
            </span>
          </span>
        </h2>
        <div class="font-mono"><span id="motivation">50</span> / 100</div>
      </div>
      <div class="card-content">
        <div class="progress-container">
          <div class="progress-fill motivation" id="motivation-progress" style="width: 67%">
            <span id="motivation-percentage">67%</span>
          </div>
        </div>
        <div id="motivation-effects"
          style="margin-top: var(--space-3); padding: var(--space-3); background: rgba(76,175,80,0.11); border-radius: var(--radius-md); border-left: 3px solid var(--accent-success); color: #2E7D32; font-size: var(--text-sm);">
          Bonus produkcji: 0% ‚Ä¢ Przyspieszenie: Normalne
        </div>
      </div>
    </div>
	<div class="card team-actions" style="margin-top: 14px;">
  <div class="card-header">
    <h3><span>‚òï</span> Dzia≈Çania Motywacyjne</h3>
  </div>
  <div class="card-content" style="text-align: center;">
    <button id="coffee-break-btn" class="coffee-action-btn">
      ‚òï Wypij kawƒô
                  <span class="tooltip-icon" tabindex="0">?
              <span class="tooltip-text">
                Zamie≈Ñ 50 kawy na:<br>
                ‚Ä¢ -20 stresu<br>
                ‚Ä¢ +10 motywacji zespo≈Çu<br>
                <br>
                (Dostƒôpne tylko je≈õli masz ‚â•50 kawy!)
              </span>
            </span>
    </button>
    <!-- Mo≈ºesz tu dodaƒá inne akcje w przysz≈Ço≈õci, np. event, premie, itd. -->
    <div style="margin-top: 6px; font-size: 13px; color: #656;">Zamie≈Ñ 50 kawy na -20 stresu i +10 motywacji!</div>
  </div>
</div>
  </div>
</div>


        <!-- GLOBAL MARKETS TAB -->
        <div class="tab-content" id="global-markets-content">
			<div class="grid grid-auto" id="region-cards-container"></div>
        </div>

        <!-- TRADE TAB -->
        <div class="tab-content" id="trade-content">
            <!-- FX Ticker -->
            <div class="fx-ticker">
                <div class="fx-title">üí± Kursy Walut - Czas Rzeczywisty</div>
                <div class="fx-pairs" id="fx-rates">
                    <div class="fx-pair" onclick="openTradeDialog('budget', 'usd')">
                        <div class="fx-pair-name">PLN/USD</div>
                        <div class="fx-rate">0.25</div>
                        <div class="fx-trend trend-stable">‚ü∑ Stabilny</div>
                    </div>
                    <div class="fx-pair" onclick="openTradeDialog('budget', 'eur')">
                        <div class="fx-pair-name">PLN/EUR</div>
                        <div class="fx-rate">0.23</div>
                        <div class="fx-trend trend-up">‚Üó Ro≈õnie</div>
                    </div>
                    <div class="fx-pair" onclick="openTradeDialog('budget', 'jpy')">
                        <div class="fx-pair-name">PLN/JPY</div>
                        <div class="fx-rate">36.5</div>
                        <div class="fx-trend trend-down">‚Üò Spada</div>
                    </div>
                    <div class="fx-pair" onclick="openTradeDialog('budget', 'cny')">
                        <div class="fx-pair-name">PLN/CNY</div>
                        <div class="fx-rate">1.78</div>
                        <div class="fx-trend trend-stable">‚ü∑ Stabilny</div>
                    </div>
                </div>
            </div>

            <!-- Active Trade Contracts -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>üìã</span>
                        Aktywne Kontrakty
                    </h2>
                </div>
                <div class="card-content">
                    <div class="text-center text-muted" id="no-trades">
                        Brak aktywnych kontrakt√≥w handlowych
                    </div>
                    <div class="grid" id="active-trades" style="display: none;">
                        <!-- Active trades will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- AUTOMATION TAB -->
        <div class="tab-content" id="automation-content">
            <div class="automation-panel">
                <div class="automation-header">
                    <h2 class="automation-title">
                        <span>ü§ñ</span>
                        Centrum Automatyzacji AI
                    </h2>
                    <button class="automation-toggle" id="master-automation" onclick="toggleMasterAutomation()">
                        W≈ÇƒÖcz Automatyzacjƒô
                    </button>
                </div>

                <div class="ai-agents" id="ai-agents">
                    <div class="ai-agent">
                        <div class="agent-info">
                            <div class="agent-status inactive" id="dept-ai-status"></div>
                            <div>
                                <div style="font-weight: 600;">Mened≈ºer Dzia≈Ç√≥w AI</div>
                                <div style="font-size: var(--text-sm); opacity: 0.8;">Automatyczne zatrudnianie dzia≈Ç√≥w na podstawie ROI</div>
                            </div>
                        </div>
                        <button class="automation-toggle" onclick="toggleDepartmentAI()">Nieaktywny</button>
                    </div>

                    <div class="ai-agent">
                        <div class="agent-info">
                            <div class="agent-status inactive" id="trade-ai-status"></div>
                            <div>
                                <div style="font-weight: 600;">Bot Handlowy</div>
                                <div style="font-size: var(--text-sm); opacity: 0.8;">Automatyczny arbitra≈º walutowy</div>
                            </div>
                        </div>
                        <button class="automation-toggle" onclick="toggleTradeBot()">Nieaktywny</button>
                    </div>

                    <div class="ai-agent">
                        <div class="agent-info">
                            <div class="agent-status inactive" id="expansion-ai-status"></div>
                            <div>
                                <div style="font-weight: 600;">Strategia Ekspansji</div>
                                <div style="font-size: var(--text-sm); opacity: 0.8;">Automatyczne odblokowanie region√≥w</div>
                            </div>
                        </div>
                        <button class="automation-toggle" onclick="toggleExpansionAI()">Nieaktywny</button>
                    </div>
                </div>
            </div>

            <!-- AI Settings -->
            <div class="card" style="margin-top: var(--space-6);">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>‚öôÔ∏è</span>
                        Ustawienia AI
                    </h2>
                </div>
                <div class="card-content">
                    <div class="grid">
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--space-2);">Pr√≥g ROI dla Dzia≈Ç√≥w (%)</label>
                            <input type="range" min="10" max="500" value="150" id="dept-roi-threshold" style="width: 100%;">
                            <div class="text-muted font-mono" id="dept-roi-display">150%</div>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--space-2);">Min. Arbitra≈º Walutowy (%)</label>
                            <input type="range" min="1" max="20" value="5" id="trade-arbitrage-threshold" style="width: 100%;">
                            <div class="text-muted font-mono" id="trade-arbitrage-display">5%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MINIGAMES TAB -->
        <div class="tab-content" id="minigames-content">
            <div class="grid grid-auto">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üéÆ</span>
                            Centrum Rozrywki Biznesowej
                        </h2>
                    </div>
                    <div class="card-content">
                        <div class="grid grid-auto" id="minigames-grid">
                            <!-- Minigames will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTROL PANEL -->
        <div style="text-align: center; padding: var(--space-6); border-top: 1px solid #e0e0e0; margin-top: var(--space-8);">
            <h3 style="color: var(--primary); margin-bottom: var(--space-4); font-size: var(--text-lg); font-weight: 700;">üéõÔ∏è Panel Kontroli</h3>
            <div style="display: flex; gap: var(--space-3); justify-content: center; flex-wrap: wrap;">
                <button id="save-game" onclick="saveGame()" style="padding: var(--space-3) var(--space-5); border: none; border-radius: var(--radius-md); font-size: var(--text-sm); font-weight: 600; cursor: pointer; color: white; background: linear-gradient(135deg, var(--primary), var(--primary-light));">üíæ Zapisz</button>
                <button id="reset-game" onclick="resetGame()" style="padding: var(--space-3) var(--space-5); border: none; border-radius: var(--radius-md); font-size: var(--text-sm); font-weight: 600; cursor: pointer; color: white; background: linear-gradient(135deg, var(--accent-warning), #FFB74D);">üîÑ Reset</button>
                <button id="export-data" onclick="exportData()" style="padding: var(--space-3) var(--space-5); border: none; border-radius: var(--radius-md); font-size: var(--text-sm); font-weight: 600; cursor: pointer; color: white; background: linear-gradient(135deg, var(--accent-success), #66BB6A);">üì§ Eksport</button>
            </div>
        </div>
    </div>
	<div id="notification-container"></div>
	<!-- ========== ACHIEVEMENT SYSTEM HTML ========== -->

	<!-- Achievement Panel (modal) -->
	<div class="achievement-panel" id="achievement-panel">
		<div class="achievement-header">
			<div>
				<h2 class="achievement-title">
					<span>üèÜ</span>
					<span>OsiƒÖgniƒôcia</span>
				</h2>
				<div class="achievement-progress-summary" id="achievement-summary">
					Postƒôp: 0 z 30 osiƒÖgniƒôƒá (0%)
				</div>
			</div>
			<button class="achievement-close" onclick="closeAchievementPanel()">&times;</button>
		</div>

		<div class="achievement-content">
			<div class="achievement-filters">
				<button class="filter-btn active" data-filter="all">Wszystkie</button>
				<button class="filter-btn" data-filter="bronze">ü•â Podstawowe</button>
				<button class="filter-btn" data-filter="silver">ü•à Zaawansowane</button>
				<button class="filter-btn" data-filter="gold">ü•á Profesjonalne</button>
				<button class="filter-btn" data-filter="platinum">üíé Mistrzowskie</button>
				<button class="filter-btn" data-filter="unlocked">Odblokowane</button>
			</div>

			<div class="achievement-grid" id="achievement-grid">
				<!-- Achievements will be populated here by JavaScript -->
			</div>
		</div>
	</div>

	<!-- Achievement notification container -->
	<div id="achievement-notification-container"></div>
	<div id="coffee-popup" class="game-popup hidden">
	  <div class="popup-content">
		<div id="coffee-popup-msg"></div>
		<button onclick="closeCoffeePopup()" class="coffee-action-btn" style="margin-top:16px;">OK</button>
	  </div>
	</div>
    <script>
        /* =============================================
           CORPOCLICKER PHASE 4.3 - CORPORATE EMPIRE
           Global Markets ‚Ä¢ AI Automation ‚Ä¢ Modern UI
           ============================================= */
        // ========== ACHIEVEMENT SYSTEM JAVASCRIPT ==========
const ACHIEVEMENTS = {
    first_steps: {
        id: "first_steps",
        name: "Pierwsze kroki",
        description: "Wykonaj 10 klikniƒôƒá w g≈Ç√≥wny przycisk",
        icon: "üë∂",
        tier: "bronze",
        requirement: {type: "click_count", value: 10},
        reward: null,
        unlocked: false,
        progress: 0
    },
    budget_builder: {
        id: "budget_builder",
        name: "Budowniczy bud≈ºetu",
        description: "OsiƒÖgnij 1000 bud≈ºetu",
        icon: "üí∞",
        tier: "bronze",
        requirement: {type: "resource_max", resource: "budget", value: 1000},
        reward: {type: "production_bonus", resource: "budget", multiplier: 1.05},
        unlocked: false,
        progress: 0
    },
    documentation_demon: {
        id: "documentation_demon",
        name: "Demon dokumentacji",
        description: "Wyprodukuj 500 dokument√≥w ≈ÇƒÖcznie",
        icon: "üìã",
        tier: "bronze",
        requirement: {type: "resourcemax", resource: "documents", value: 500},
        reward: {type: "production_bonus", resource: "documents", multiplier: 1.1},
        unlocked: false,
        progress: 0
    },
    coffee_addict: {
        id: "coffee_addict",
        name: "Kofeinowy uzale≈ºniony",
        description: "U≈ºyj funkcji kawy 25 razy",
        icon: "‚òï",
        tier: "bronze",
        requirement: {type: "coffee_breaks", value: 25},
        reward: {type: "coffee_efficiency", multiplier: 1.2},
        unlocked: false,
        progress: 0
    },
    hr_pioneer: {
        id: "hr_pioneer",
        name: "Pionier HR",
        description: "Zatrudnij pierwszy dzia≈Ç HR",
        icon: "üë•",
        tier: "bronze",
        requirement: {type: "department_hired", department: "hr", value: 1},
        reward: null,
        unlocked: false,
        progress: 0
    },
    tech_savvy: {
        id: "tech_savvy",
        name: "Techniczny mistrz",
        description: "Odblokuj dzia≈Ç IT",
        icon: "üíª",
        tier: "bronze",
        requirement: {type: "department_unlocked", department: "it"},
        reward: {type: "production_bonus", resource: "coffee", multiplier: 1.05},
        unlocked: false,
        progress: 0
    },
    marketing_guru: {
        id: "marketing_guru",
        name: "Guru marketingu",
        description: "Zatrudnij 5 os√≥b w marketingu",
        icon: "üìä",
        tier: "silver",
        requirement: {type: "department_hired", department: "marketing", value: 5},
        reward: {type: "production_bonus", resource: "prestige", multiplier: 1.15},
        unlocked: false,
        progress: 0
    },
    numbers_game: {
        id: "numbers_game",
        name: "Gra liczbami",
        description: "Odblokuj ksiƒôgowo≈õƒá",
        icon: "üßÆ",
        tier: "silver",
        requirement: {type: "department_unlocked", department: "accounting"},
        reward: {type: "cost_reduction", department: "all", multiplier: 0.95},
        unlocked: false,
        progress: 0
    },
    stress_survivor: {
        id: "stress_survivor",
        name: "Przetrwaniec stresu",
        description: "OsiƒÖgnij 150 punkt√≥w stresu",
        icon: "üò∞",
        tier: "silver",
        requirement: {type: "stress_peak", value: 150},
        reward: {type: "stress_resistance", multiplier: 0.9},
        unlocked: false,
        progress: 0
    },
    motivation_master: {
        id: "motivation_master",
        name: "Mistrz motywacji",
        description: "OsiƒÖgnij 90 punkt√≥w motywacji",
        icon: "üî•",
        tier: "silver",
        requirement: {type: "motivation_peak", value: 90},
        reward: {type: "motivation_bonus", multiplier: 1.1},
        unlocked: false,
        progress: 0
    },
    prestige_player: {
        id: "prestige_player",
        name: "Gracz presti≈ºu",
        description: "OsiƒÖgnij 100 punkt√≥w presti≈ºu",
        icon: "üéñÔ∏è",
        tier: "silver",
        requirement: {type: "resource_max", resource: "prestige", value: 100},
        reward: {type: "production_bonus", resource: "budget", multiplier: 1.1},
        unlocked: false,
        progress: 0
    },
    globalist: {
        id: "globalist",
        name: "Globalista",
        description: "Odblokuj drugi region (Ameryki)",
        icon: "üåé",
        tier: "silver",
        requirement: {type: "region_unlocked", region: "americas"},
        reward: {type: "global_expansion_bonus", multiplier: 1.05},
        unlocked: false,
        progress: 0
    },
    forex_trader: {
        id: "forex_trader",
        name: "Trader forex",
        description: "Wykonaj pierwszƒÖ wymianƒô walut",
        icon: "üí±",
        tier: "bronze",
        requirement: {type: "currency_trade", value: 1},
        reward: {type: "fx_fee_reduction", multiplier: 0.95},
        unlocked: false,
        progress: 0
    },
    call_center_king: {
        id: "call_center_king",
        name: "Kr√≥l call center",
        description: "Odblokuj call center",
        icon: "üìû",
        tier: "gold",
        requirement: {type: "department_unlocked", department: "callcenter"},
        reward: {type: "production_bonus", resource: "budget", multiplier: 1.2},
        unlocked: false,
        progress: 0
    },
    asian_expansion: {
        id: "asian_expansion",
        name: "Ekspansja azjatycka",
        description: "Odblokuj region Azja-Pacyfik",
        icon: "üåè",
        tier: "gold",
        requirement: {type: "region_unlocked", region: "asia"},
        reward: {type: "global_market_bonus", multiplier: 1.15},
        unlocked: false,
        progress: 0
    },
    rd_innovator: {
        id: "rd_innovator",
        name: "Innowator R&D",
        description: "Zatrudnij 3 osoby w R&D",
        icon: "üî¨",
        tier: "gold",
        requirement: {type: "department_hired", department: "rd", value: 3},
        reward: {type: "innovation_bonus", multiplier: 1.25},
        unlocked: false,
        progress: 0
    },
    budget_millionaire: {
        id: "budget_millionaire",
        name: "Milioner bud≈ºetowy",
        description: "OsiƒÖgnij 1,000,000 bud≈ºetu",
        icon: "üíé",
        tier: "gold",
        requirement: {type: "resource_max", resource: "budget", value: 1000000},
        reward: {type: "production_bonus", resource: "budget", multiplier: 1.3},
        unlocked: false,
        progress: 0
    },
    automation_pioneer: {
        id: "automation_pioneer",
        name: "Pionier automatyzacji",
        description: "W≈ÇƒÖcz system automatyzacji AI",
        icon: "ü§ñ",
        tier: "gold",
        requirement: {type: "automation_enabled"},
        reward: {type: "automation_efficiency", multiplier: 1.1},
        unlocked: false,
        progress: 0
    },
    stress_zen: {
        id: "stress_zen",
        name: "Zen stresu",
        description: "Utrzymaj stres poni≈ºej 20 przez 2 minuty",
        icon: "üßò",
        tier: "silver",
        requirement: {type: "stress_low", value: 20, duration: 120000},
        reward: {type: "stress_generation", multiplier: 0.8},
        unlocked: false,
        progress: 0
    },
    multicurrency_master: {
        id: "multicurrency_master",
        name: "Mistrz wielu walut",
        description: "Posiadaj wszystkie 4 waluty obce jednocze≈õnie",
        icon: "üè¶",
        tier: "gold",
        requirement: {type: "all_currencies", currencies: ["usd", "eur", "jpy", "cny"]},
        reward: {type: "currency_bonus", multiplier: 1.1},
        unlocked: false,
        progress: 0
    },
    clicker_veteran: {
        id: "clicker_veteran",
        name: "Weteran klikanek",
        description: "Wykonaj 1,000 klikniƒôƒá ≈ÇƒÖcznie",
        icon: "üëÜ",
        tier: "gold",
        requirement: {type: "click_count", value: 1000},
        reward: {type: "click_power", multiplier: 1.05},
        unlocked: false,
        progress: 0
    },
    department_emperor: {
        id: "department_emperor",
        name: "Cesarz dzia≈Ç√≥w",
        description: "Odblokuj wszystkie dzia≈Çy",
        icon: "üëë",
        tier: "platinum",
        requirement: {type: "all_departments_unlocked"},
        reward: {type: "department_synergy", multiplier: 1.2},
        unlocked: false,
        progress: 0
    },
    global_tycoon: {
        id: "global_tycoon",
        name: "Globalny potentat",
        description: "Odblokuj wszystkie regiony",
        icon: "üåç",
        tier: "platinum",
        requirement: {type: "all_regions_unlocked"},
        reward: {type: "global_dominance", multiplier: 1.5},
        unlocked: false,
        progress: 0
    },
    coffee_connoisseur: {
        id: "coffee_connoisseur",
        name: "Koneser kawy",
        description: "U≈ºyj funkcji kawy 100 razy",
        icon: "‚òï",
        tier: "gold",
        requirement: {type: "coffee_breaks", value: 100},
        reward: {type: "coffee_power", multiplier: 1.3},
        unlocked: false,
        progress: 0
    },
    efficiency_expert: {
        id: "efficiency_expert",
        name: "Ekspert efektywno≈õci",
        description: "OsiƒÖgnij 100% efektywno≈õƒá we wszystkich podstawowych zasobach",
        icon: "‚ö°",
        tier: "gold",
        requirement: {type: "full_efficiency"},
        reward: {type: "efficiency_master", multiplier: 1.1},
        unlocked: false,
        progress: 0
    },
    minigame_master: {
        id: "minigame_master",
        name: "Mistrz minigier",
        description: "Wygraj prezentacjƒô kwartalnƒÖ 3 razy",
        icon: "üéØ",
        tier: "gold",
        requirement: {type: "minigame_wins", game: "quarterlypresentation", value: 3},
        reward: {type: "minigame_bonus", multiplier: 1.25},
        unlocked: false,
        progress: 0
    },
    african_explorer: {
        id: "african_explorer",
        name: "Odkrywca Afryki",
        description: "Odblokuj region Afryka",
        icon: "üåç",
        tier: "platinum",
        requirement: {type: "region_unlocked", region: "africa"},
        reward: {type: "exploration_bonus", multiplier: 1.2},
        unlocked: false,
        progress: 0
    },
    middle_east_mogul: {
        id: "middle_east_mogul",
        name: "Potentat Bliskiego Wschodu",
        description: "Odblokuj region Bliskiego Wschodu",
        icon: "üïå",
        tier: "platinum",
        requirement: {type: "region_unlocked", region: "middleeast"},
        reward: {type: "premium_markets", multiplier: 1.4},
        unlocked: false,
        progress: 0
    },
    ultimate_corporate: {
        id: "ultimate_corporate",
        name: "Ostateczny korporacyjny",
        description: "OsiƒÖgnij 500 presti≈ºu i odblokuj wszystkie regiony",
        icon: "üèÜ",
        tier: "platinum",
        requirement: {type: "combined", requirements: [
            {type: "resource_max", resource: "prestige", value: 500},
            {type: "all_regions_unlocked"}
        ]},
        reward: {type: "ultimate_bonus", multiplier: 2.0},
        unlocked: false,
        progress: 0
    },
    speed_demon: {
        id: "speed_demon",
        name: "Demon prƒôdko≈õci",
        description: "Wykonaj 50 klikniƒôƒá w ciƒÖgu 10 sekund",
        icon: "üí®",
        tier: "silver",
        requirement: {type: "click_speed", clicks: 50, time: 10000},
        reward: {type: "click_speed_bonus", multiplier: 1.05},
        unlocked: false,
        progress: 0
    }
};
        class CorpoClickerPhase43 {
            constructor() {
                this.version = "4.3.0-dev";

                console.log('üè¶ Initializing CorpoClicker Phase 4.3 - Corporate Empire...');

                // Core Resources (from 4.2.2)
                this.resources = {
                    budget: 100,
                    documents: 0,
                    coffee: 0,
                    stress: 0,
                    motivation: 50,
                    prestige: 0,
                    influence: 0,

                    // NEW: International Currencies
                    usd: 0,
                    eur: 0,
                    jpy: 0,
                    cny: 0,
                    freight: 0
                };

                // Enhanced Departments (from 4.2.2)
                this.departments = {
                    hr: { owned: 0, unlocked: true },
                    it: { owned: 0, unlocked: false },
                    marketing: { owned: 0, unlocked: false },
                    wellbeing: { owned: 0, unlocked: false },
					accounting: { owned: 0, unlocked: false },
                    management: { owned: 0, unlocked: false },
                    rd: { owned: 0, unlocked: false },
                    callcenter: { owned: 0, unlocked: false }
                };

                // NEW: Global Regions System
                this.regions = {
                    europe: {
                        name: "Europa",
                        flag: "üá™üá∫",
                        currency: "eur",
                        unlocked: true,
                        unlockCost: 0,
                        level: 1,
						upgradeCost: 1000,
						currencyProduction: 0.05,
                        departments: { ...this.departments },
                        resources: { eur: 0, documents: 0, coffee: 0 },
                        marketModifier: 1.0,
                        culturalCost: 0,
						bonus: "marketing"
                    },
                    americas: {
                        name: "Ameryki",
                        flag: "üåé",
                        currency: "usd",
                        unlocked: false,
                        unlockCost: 10000,
                        level: 0,
						upgradeCost: 10000,
						currencyProduction: 0.05,
                        departments: { ...this.departments },
                        resources: { usd: 0, documents: 0, coffee: 0 },
                        marketModifier: 1.2,
                        culturalCost: 100,
						bonus: "legal"
                    },
                    asia: {
                        name: "Azja-Pacyfik",
                        flag: "üåè",
                        currency: "jpy",
                        unlocked: false,
                        unlockCost: 50000,
                        level: 0,
						upgradeCost: 50000,
						currencyProduction: 0.05,
                        departments: { ...this.departments },
                        resources: { jpy: 0, documents: 0, coffee: 0 },
                        marketModifier: 1.5,
                        culturalCost: 500,
						bonus: "trade"
                    },
                    africa: {
                        name: "Afryka",
                        flag: "üåç",
                        currency: "cny",
                        unlocked: false,
                        unlockCost: 100000,
                        level: 0,
						upgradeCost: 100000,
						currencyProduction: 0.05,
                        departments: { ...this.departments },
                        resources: { cny: 0, documents: 0, coffee: 0 },
                        marketModifier: 0.8,
                        culturalCost: 200,
						bonus: "rnd"
                    },
                    middleeast: {
                        name: "Bliski Wsch√≥d",
                        flag: "üïå",
                        currency: "cny", // Simplified - in reality would be different currencies
                        unlocked: false,
                        unlockCost: 250000,
                        level: 0,
						upgradeCost: 250000,
						currencyProduction: 0.05,
                        departments: { ...this.departments },
                        resources: { cny: 0, documents: 0, coffee: 0 },
                        marketModifier: 1.8,
                        culturalCost: 1000
                    }
                };

                // NEW: FX Exchange Rates
                this.fxRates = {
                    'budget_to_usd': { rate: 0.25, trend: 'stable', lastUpdate: Date.now() },
                    'budget_to_eur': { rate: 0.23, trend: 'up', lastUpdate: Date.now() },
                    'budget_to_jpy': { rate: 36.5, trend: 'down', lastUpdate: Date.now() },
                    'budget_to_cny': { rate: 1.78, trend: 'stable', lastUpdate: Date.now() },
                    'usd_to_eur': { rate: 0.92, trend: 'stable', lastUpdate: Date.now() },
                    'eur_to_jpy': { rate: 158.7, trend: 'up', lastUpdate: Date.now() }
                };

                // NEW: AI Automation System
                this.automation = {
                    enabled: false,
                    departmentAI: {
                        active: false,
                        roiThreshold: 1.5, // 150% ROI required
                        lastAction: 0
                    },
                    tradeBot: {
                        active: false,
                        arbitrageThreshold: 0.05, // 5% minimum arbitrage
                        lastAction: 0
                    },
                    expansionAI: {
                        active: false,
                        aggressiveness: 0.5,
                        lastAction: 0
                    }
                };

				this.globalEventTickCounter = 0;

				// Enhanced Game State
                this.gameState = {
                    lastUpdate: Date.now(),
                    totalClicks: 0,
                    sessionStart: Date.now(),
                    gameSpeed: 1.0,
                    paused: false,
                    activeEffects: {},
                    minigameCooldowns: {},
                    currentTab: 'overview',
                    lastDisplayUpdate: {
                        departments: 0,
                        minigames: 0,
                        regions: 0,
                        fx: 0
                    }
                };

                // Department Data (from 4.2.2)
                this.departmentData = {
                    hr: {
                        name: "Dzia≈Ç HR",
                        icon: "üë•",
                        baseCost: 10,
                        production: {documents: 1},
                        sideEffects: {stress: 0.01},
                        description: "Produkuje dokumenty korporacyjne. Zwiƒôksza stres przez biurokracjƒô.",
                        unlockConditions: []
                    },
                    it: {
                        name: "Dzia≈Ç IT",
                        icon: "üíª",
                        baseCost: 20,
                        production: {coffee: 1},
                        sideEffects: {motivation: -0.05},
                        description: "Zapewnia kawƒô premium i wsparcie techniczne.",
                        unlockConditions: [
                            {type: 'resource', resource: 'documents', amount: 100}
                        ]
                    },
                    marketing: {
                        name: "Marketing",
                        icon: "üìà",
                        baseCost: 35,
                        production: {budget: 1, prestige: 0.04},
                        description: "Generuje przychody i buduje presti≈º marki.",
                        unlockConditions: [
                            {type: 'resource', resource: 'documents', amount: 150}
                        ]
                    },
					wellbeing: {
						name: "Zesp√≥≈Ç Wellbeing",
						icon: "üßò‚Äç‚ôÇÔ∏è",
						baseCost: 45,
						production: {},
						sideEffects: {
						  stress: -0.015,          // obni≈ºa stres
						  motivation: 0.04,      // podnosi motywacjƒô
						  budget: -3,            // uderza w bud≈ºet
						  documents: -0.5          // uderza w dokumenty
						},
						description: "Ka≈ºda zatrudniona osoba poprawia morale i atmosferƒô, ale obni≈ºa bud≈ºet i dokumentacjƒô.",
						unlockConditions: [
							{type: 'resource', resource: 'prestige', amount: 20}
						]
					},
                    accounting: {
                        name: "Ksiƒôgowo≈õƒá",
                        icon: "üßÆ",
                        baseCost: 55,
                        production: {budget: 0.8},
                        sideEffects: {stress: 0.05},
                        description: "Optymalizuje finanse, ale zwiƒôksza stres przez kontrole.",
                        unlockConditions: [
                            {type: 'resource', resource: 'documents', amount: 350}
                        ]
                    },
                    management: {
                        name: "ZarzƒÖd",
                        icon: "üëî",
                        baseCost: 90,
                        production: {motivation: 0.3},
                        description: "Motywuje pracownik√≥w i poprawia efektywno≈õƒá organizacyjnƒÖ.",
                        unlockConditions: [
                            {type: 'resource', resource: 'prestige', amount: 50}
                        ]
                    },
                    rd: {
                        name: "R&D",
                        icon: "üî¨",
                        baseCost: 150,
                        production: {prestige: 0.3},
                        sideEffects: {stress: 0.02},
                        description: "Innowacje zwiƒôkszajƒÖ presti≈º, ale wymagajƒÖ intensywnej pracy.",
                        unlockConditions: [
                            {type: 'resource', resource: 'prestige', amount: 150}
                        ]
                    },
                    callcenter: {
                        name: "Call Center",
                        icon: "üìû",
                        baseCost: 300,
                        production: {budget: 4},
                        sideEffects: {motivation: -0.03, stress: 0.05},
                        description: "Wysokie przychody kosztem dobrostanu pracownik√≥w.",
                        unlockConditions: [
                            {type: 'resource', resource: 'documents', amount: 10000}
                        ]
                    }
                };

                // Minigame Data (from 4.2.2)
                this.minigameData = {
                    quarterly_presentation: {
                        name: "Prezentacja Kwartalna",
                        icon: "üìä",
                        cost: { documents: 100, coffee: 50 },
                        description: "Wysokopostawowa prezentacja dla zarzƒÖdu z ryzykiem utraty presti≈ºu.",
                        rewards: {
                            success: { budget: 500, prestige: 10 },
                            failure: { budget_loss_percent: 0.2, stress: 25 }
                        },
                        cooldown: 300000, // 5 minutes
                        unlocked: () => this.resources.documents >= 50
                    },

                    barista_championship: {
                        name: "Mistrzostwa Baristy",
                        icon: "‚òï",
                        cost: { coffee: 200, prestige: 25 },
                        description: "Konkurs umiejƒôtno≈õci parzenia kawy z mo≈ºliwo≈õciƒÖ rozwiniƒôcia kawiarni.",
                        rewards: {
                            success: { coffee_shop_level: 1, passive_income: 10 },
                            failure: { coffee_addiction: 1, motivation: -15 }
                        },
                        cooldown: 600000, // 10 minutes
                        unlocked: () => this.departments.it.owned >= 3
                    },

                    corporate_merger: {
                        name: "Fuzja Korporacyjna",
                        icon: "ü§ù",
                        cost: { budget: 5000, documents: 100 },
                        description: "Ryzykowna fuzja z konkurencjƒÖ. Ogromne zyski lub katastrofalne straty.",
                        rewards: {
                            success: { subsidiary: 1, all_production: 1.25 },
                            failure: { budget_loss_percent: 0.5, departments_loss: 1 }
                        },
                        cooldown: 1800000, // 30 minutes
                        unlocked: () => this.resources.prestige >= 50
                    },

                    government_lobbying: {
                        name: "Lobbying RzƒÖdowy",
                        icon: "üèõÔ∏è",
                        cost: { prestige: 50, budget: 1000 },
                        description: "Wp≈Çywanie na politykƒô gospodarczƒÖ w celu korzystnych regulacji.",
                        rewards: {
                            success: { softcap_increase: 0.25, tax_reduction: 0.1 },
                            failure: { investigation: true, production_penalty: 0.3 }
                        },
                        cooldown: 3600000, // 1 hour
                        unlocked: () => this.resources.prestige >= 100
                    },

                    // NEW: Global expansion minigame
                    global_summit: {
                        name: "Szczyt Globalny",
                        icon: "üåç",
                        cost: { prestige: 100, usd: 1000, eur: 800 },
                        description: "Miƒôdzynarodowa konferencja biznesowa. Mo≈ºliwo≈õƒá ekspansji lub skandalu.",
                        rewards: {
                            success: { global_expansion_bonus: 0.5, freight: 50 },
                            failure: { reputation_loss: 1, region_lock: 30 }
                        },
                        cooldown: 7200000, // 2 hours
                        unlocked: () => Object.values(this.regions).filter(r => r.unlocked).length >= 3
                    }
                };

                // Softcap System (from 4.2.2)
				this.softcapThresholds = {
					budget:    [1000, 5000, 25000, 125000, 800000, 4000000],
					documents: [100, 500, 2500, 12500, 60000, 250000],
					coffee:    [50, 250, 1250, 6250, 30000, 120000],
					prestige:  [10, 50, 250, 1250, 6000, 25000],
					usd:       [100, 500, 2500, 12500, 60000, 250000],
					eur:       [100, 500, 2500, 12500, 60000, 250000],
					jpy:       [10000, 50000, 250000, 1250000, 6000000, 25000000],
					cny:       [500, 2500, 12500, 62500, 300000, 1200000]
				};
                this.achievements = {};
				this.achievementBonuses = {};
				this.gameState.coffeeBreaks = 0;
				this.gameState.maxStress = 0;
				this.gameState.maxMotivation = this.resources.motivation;
				this.gameState.currencyTrades = 0;
				this.gameState.minigameWins = {};
				this.gameState.totalProduced = {
					budget: 0,
					documents: 0,
					coffee: 0,
					prestige: 0
				};
				this.initializeAchievements();
                this.init();
            }

			initializeAchievements() {
    // Initialize all achievements from the ACHIEVEMENTS constant
    Object.keys(ACHIEVEMENTS).forEach(id => {
        this.achievements[id] = {
            ...ACHIEVEMENTS[id],
            unlocked: false,
            progress: 0
        };
    });

    // Update progress indicator
    this.updateAchievementProgress();
}

checkAchievements() {
    let newUnlocks = [];

    Object.keys(this.achievements).forEach(id => {
        const achievement = this.achievements[id];
        if (achievement.unlocked) return;

        if (this.checkAchievementRequirement(achievement)) {
            this.unlockAchievement(id);
            newUnlocks.push(achievement);
        }
    });

    // Show notifications for new unlocks
    newUnlocks.forEach(achievement => {
        setTimeout(() => showAchievementNotification(achievement), 500);
    });

    if (newUnlocks.length > 0) {
        this.updateAchievementProgress();
    }
}

checkAchievementRequirement(achievement) {
    const req = achievement.requirement;

    switch (req.type) {
        case 'click_count':
            return this.gameState.totalClicks >= req.value;

        case 'resource_max':
            return this.resources[req.resource] >= req.value;

        case 'resource_total':
            return (this.gameState.this.resources.documents[req.resource] || 0) >= req.value;

        case 'department_hired':
            return this.departments[req.department]?.owned >= req.value;

        case 'department_unlocked':
            return this.departments[req.department]?.unlocked === true;

        case 'region_unlocked':
            return this.regions[req.region]?.unlocked === true;

        case 'coffee_breaks':
            return this.gameState.coffeeBreaks >= req.value;

        case 'stress_peak':
            return this.gameState.maxStress >= req.value;

        case 'motivation_peak':
            return this.gameState.maxMotivation >= req.value;

        case 'currency_trade':
            return this.gameState.currencyTrades >= req.value;

        case 'automation_enabled':
            return this.automation.enabled === true;

        case 'all_currencies':
            return req.currencies.every(currency => this.resources[currency] > 0);

        case 'all_departments_unlocked':
            return Object.values(this.departments).every(dept => dept.unlocked);

        case 'all_regions_unlocked':
            return Object.values(this.regions).every(region => region.unlocked);

        case 'full_efficiency':
            const basicResources = ['budget', 'documents', 'coffee', 'prestige'];
            return basicResources.every(resource =>
                this.calculateSoftcap(resource, this.resources[resource]) >= 0.99
            );

        case 'minigame_wins':
            return (this.gameState.minigameWins[req.game] || 0) >= req.value;

        case 'combined':
            return req.requirements.every(subReq =>
                this.checkAchievementRequirement({requirement: subReq})
            );

        default:
            return false;
    }
}

unlockAchievement(id) {
    const achievement = this.achievements[id];
    if (!achievement || achievement.unlocked) return;

    achievement.unlocked = true;

    // Apply reward if exists
    if (achievement.reward) {
        this.applyAchievementReward(achievement.reward);
    }

    console.log(`Achievement unlocked: ${achievement.name}`);
	this.updateAchievementProgress();
}

applyAchievementReward(reward) {
    switch (reward.type) {
        case 'production_bonus':
            // Store bonus for use in production calculations
            if (!this.achievementBonuses[reward.resource]) {
                this.achievementBonuses[reward.resource] = 1;
            }
            this.achievementBonuses[reward.resource] *= reward.multiplier;
            break;

        case 'cost_reduction':
            this.achievementBonuses.costReduction = (this.achievementBonuses.costReduction || 1) * reward.multiplier;
            break;

        case 'click_power':
            this.achievementBonuses.clickPower = (this.achievementBonuses.clickPower || 1) * reward.multiplier;
            break;

        case 'coffee_efficiency':
            this.achievementBonuses.coffeeEfficiency = (this.achievementBonuses.coffeeEfficiency || 1) * reward.multiplier;
            break;

        default:
            // Store other bonuses generically
            this.achievementBonuses[reward.type] = (this.achievementBonuses[reward.type] || 1) * reward.multiplier;
    }
}

updateAchievementProgress() {
    const indicator = document.getElementById('achievement-progress-indicator');
    const progressText = document.getElementById('achievement-progress-text');

    if (!indicator || !progressText) return;

    const unlockedCount = Object.values(this.achievements).filter(a => a.unlocked).length;
    const totalCount = Object.keys(this.achievements).length;
    const percentage = Math.round((unlockedCount / totalCount) * 100);

    progressText.textContent = `OsiƒÖgniƒôcia: ${unlockedCount}/${totalCount} (${percentage}%)`;

    // Update indicator color based on progress
    if (percentage >= 100) {
        indicator.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
    } else if (percentage >= 75) {
        indicator.style.background = 'linear-gradient(135deg, #4CAF50, #66BB6A)';
    } else if (percentage >= 50) {
        indicator.style.background = 'linear-gradient(135deg, #2196F3, #42A5F5)';
    }
}

            /* =============================================
               CORE SYSTEMS FROM 4.2.2
               ============================================= */

calculateSoftcap(resource, amount) {
    const thresholds = this.softcapThresholds[resource];
    if (!thresholds || amount <= thresholds[0]) {
        return 1.0;
    }

    let efficiency = 1.0;

    if (amount > thresholds[0] && amount <= thresholds[1]) {
        // Pierwszy softcap: min. 75%, max 100%
        const ratio = amount / thresholds[0];
        efficiency = 0.75 + 0.25 * Math.log(thresholds[1]/thresholds[0]) / Math.log(ratio);
        efficiency = Math.max(0.75, Math.min(1.0, efficiency));
    } else if (amount > thresholds[1] && amount <= thresholds[2]) {
        // Drugi softcap: min. 40%, max 74%
        const ratio = (amount - thresholds[1]) / (thresholds[2] - thresholds[1]);
        efficiency = 0.40 + 0.35 * (1 - ratio);
    } else if (amount > thresholds[2]) {
        // Dalej: min. 14%, max. 40%; wolniejsze wygasanie
        const excess = (amount - thresholds[2]) / thresholds[2];
        efficiency = 0.14 + 0.26 * Math.exp(-excess * 0.75); // zwolnione opadanie wyk≈Çadnicze
    }

    return Math.max(0.09, efficiency);
}

            calculateStressEffects() {
                const stress = this.resources.stress;
                let production = 1.0;
                let quality = 1.0;
                let quitChance = 0.0;

                if (stress <= 25) {
                    production = 1.0; quality = 1.0; quitChance = 0.0;
                } else if (stress <= 50) {
                    production = 0.95; quality = 0.9; quitChance = 0.01;
                } else if (stress <= 75) {
                    production = 0.85; quality = 0.75; quitChance = 0.03;
                } else if (stress <= 100) {
                    production = 0.70; quality = 0.50; quitChance = 0.06;
                } else {
                    production = Math.max(0.05, 1.0 - (stress - 100) * 0.01);
                    quality = Math.max(0.01, 1.0 - (stress - 100) * 0.015);
                    quitChance = Math.min(0.40, (stress - 100) * 0.005);
                }

                return { production, quality, quitChance };
            }

            calculateMotivationEffects() {
                const motivation = this.resources.motivation;
                let productionBonus = 0;
                let speedBonus = 1.0;

                if (motivation <= -25) {
                    productionBonus = -0.75; speedBonus = 0.5;
                } else if (motivation <= 0) {
                    productionBonus = -0.50; speedBonus = 0.7;
                } else if (motivation <= 25) {
                    productionBonus = -0.25; speedBonus = 0.85;
                } else if (motivation <= 50) {
                    productionBonus = 0; speedBonus = 1.0;
                } else if (motivation <= 75) {
                    productionBonus = 0.25; speedBonus = 1.15;
                } else if (motivation <= 90) {
                    productionBonus = 0.50; speedBonus = 1.35;
                } else {
                    productionBonus = 1.0; speedBonus = 1.5;
                }

                return { productionBonus, speedBonus };
            }

convertDocumentsToBudget = function() {
  if (this.resources.documents < 100) {
    document.getElementById('documents-panel-feedback').textContent = "Za ma≈Ço dokument√≥w!";
    return;
  }
  this.resources.documents -= 100;
  this.resources.budget += 2000;
  document.getElementById('documents-panel-feedback').textContent =
    "Zrealizowano kontrakt! +2000 bud≈ºetu üöÄ";
  this.updateResourceBar();
};

unlockHrAutomation = function() {
  if (this.resources.documents < 3000) {
    document.getElementById('documents-panel-feedback').textContent = "Za ma≈Ço dokument√≥w!";
    return;
  }
  this.resources.documents -= 3000;
  this.hrAutomated = true;
  document.getElementById('documents-panel-feedback').textContent =
    "HR Automatyzowany! Zasoby HR bƒôdƒÖ zarzƒÖdzane automatycznie.";
  this.updateResourceBar();
  // Dodaj logikƒô automatyzacji HR w ticku gry
};

upgradeDocsDepartment = function() {
  if (this.resources.documents < 5000) {
    document.getElementById('documents-panel-feedback').textContent = "Za ma≈Ço dokument√≥w!";
    return;
  }
  this.resources.documents -= 5000;
  this.docsDeptLevel = (this.docsDeptLevel || 1) + 1;
  document.getElementById('documents-panel-feedback').textContent =
    `Upgrade dzia≈Çu dokument√≥w! Poziom: ${this.docsDeptLevel}`;
  this.updateResourceBar();
  // Mo≈ºesz dodaƒá wy≈ºszy multiplikator w produkcji dokument√≥w!
};

researchDocsProcedure = function() {
  if (this.resources.documents < 7000) {
    document.getElementById('documents-panel-feedback').textContent = "Za ma≈Ço dokument√≥w!";
    return;
  }
  this.resources.documents -= 7000;
  // Losowy bonus (np. +10% efficiency na 10 minut, presti≈º, premia do bud≈ºetu)
  const bonus = Math.floor(Math.random() * 4);
  let msg = "";
  switch (bonus) {
    case 0:
      this.resources.budget += 10000;
      msg = "+10 000 bud≈ºetu üöÄ";
      break;
    case 1:
      this.resources.prestige += 15;
      msg = "+15 presti≈ºu üèÜ";
      break;
    case 2:
      this.softcapThresholds.documents = this.softcapThresholds.documents.map(x => x + 1000);
      msg = "Progi softcap dokument√≥w przesuniƒôte! üîÅ";
      break;
    default:
      msg = "Dokumentacja zbadana ‚Äî bonus efektywno≈õci!";
      // Dodaj np. tymczasowy bonus efficiency
  }
  document.getElementById('documents-panel-feedback').textContent =
    `Badania zako≈Ñczone: ${msg}`;
  this.updateResourceBar();
};


            /* =============================================
               NEW: GLOBAL REGIONS SYSTEM
               ============================================= */

            checkRegionUnlocks() {
                Object.entries(this.regions).forEach(([regionId, region]) => {
                    if (region.unlocked) return;

                    if (this.resources.budget >= region.unlockCost) {
                        // Could unlock, but don't auto-unlock (player choice)
                        this.updateRegionDisplay();
                    }
                });
            }
            updateRegionDisplay() {
			  this.updateGlobalPresenceCard();
			  this.updateGlobalMarketsTab();
			}
            unlockRegion(regionId) {
                const region = this.regions[regionId];

                if (!region || region.unlocked) return false;

                if (this.resources.budget >= region.unlockCost) {
                    this.resources.budget -= region.unlockCost;
                    region.unlocked = true;
                    region.level = 1;

                    this.showNotification(`üåç Otwarto nowy region: ${region.name}!`, 'success');
                    this.updateResourceBar();
                    return true;
                }

                this.showNotification(`üí∞ NiewystarczajƒÖcy bud≈ºet! Potrzebujesz ${region.unlockCost} üí∞`, 'warning');
                return false;
				this.updateResourceBar();
            }

            /* =============================================
               NEW: FX TRADING SYSTEM
               ============================================= */

			updateFXBarDisplay() {
			  Object.entries(this.fxRates).forEach(([pair, data]) => {
				const rateElem = document.getElementById(`fx-rate-${pair}`);
				if (rateElem) rateElem.textContent = data.rate.toFixed(3);

				const trendElem = document.getElementById(`fx-trend-${pair}`);
				if (trendElem) {
				  trendElem.textContent = (data.trend === 'up') ? 'Ro≈õnie' : (data.trend === 'down') ? 'Spada' : 'Stabilny';
				  trendElem.className = 'fx-trend trend-' + data.trend;
				}
			  });
			}

			updateFXRates() {
                const now = Date.now();

                Object.entries(this.fxRates).forEach(([pair, data]) => {
                    if (now - data.lastUpdate < 30000) return; // Update every 30s

                    // Simulate market volatility
                    const volatility = 0.02; // 2% max change
                    const change = (Math.random() - 0.5) * volatility;
                    const newRate = data.rate * (1 + change);

                    // Update trend
                    if (newRate > data.rate * 1.005) {
                        data.trend = 'Ro≈õnie';
                    } else if (newRate < data.rate * 0.995) {
                        data.trend = 'Spada';
                    } else {
                        data.trend = 'Stabilny';
                    }

                    data.rate = Math.max(newRate, data.rate * 0.5); // Prevent extreme drops
                    data.lastUpdate = now;
                });

                this.updateFXBarDisplay();
            }

            executeTrade(fromCurrency, toCurrency, amount) {
                const pair = `${fromCurrency}_to_${toCurrency}`;
                const fxData = this.fxRates[pair];

                if (!fxData || this.resources[fromCurrency] < amount) {
                    this.showNotification('NiewystarczajƒÖce ≈õrodki do wymiany!', 'warning');
                    return false;
                }

                const received = amount * fxData.rate;
                const fee = received * 0.01; // 1% transaction fee
                const netReceived = received - fee;

                this.resources[fromCurrency] -= amount;
                this.resources[toCurrency] += netReceived;
                this.resources.freight += Math.floor(amount / 100); // Freight tokens
                this.gameState.currencyTrades = (this.gameState.currencyTrades || 0) + 1;
                this.showNotification(`üí± Wymiana: -${amount} ${fromCurrency} ‚Üí +${netReceived.toFixed(2)} ${toCurrency}`, 'success');
                this.updateResourceBar();

                return true;
            }

            /* =============================================
               NEW: AI AUTOMATION SYSTEM
               ============================================= */

            toggleMasterAutomation() {
                this.automation.enabled = !this.automation.enabled;

                const button = document.getElementById('master-automation');
                if (this.automation.enabled) {
                    button.textContent = 'Wy≈ÇƒÖcz Automatyzacjƒô';
                    button.classList.add('active');
                    this.showNotification('ü§ñ Automatyzacja w≈ÇƒÖczona!', 'success');
                } else {
                    button.textContent = 'W≈ÇƒÖcz Automatyzacjƒô';
                    button.classList.remove('active');
                    this.showNotification('‚è∏Ô∏è Automatyzacja wy≈ÇƒÖczona!', 'info');
                }

                this.updateAutomationDisplay();
            }

            runDepartmentAI() {
                if (!this.automation.enabled || !this.automation.departmentAI.active) return;

                const now = Date.now();
                if (now - this.automation.departmentAI.lastAction < 10000) return; // 10s cooldown

                // Find best ROI department
                let bestROI = 0;
                let bestDept = null;

                Object.entries(this.departmentData).forEach(([deptId, deptData]) => {
                    const dept = this.departments[deptId];
                    if (!dept.unlocked) return;

                    const cost = this.getDepartmentCost(deptId);
                    if (this.resources.budget < cost) return;

                    // Calculate ROI based on production
                    let production = 0;
                    if (deptData.production) {
                        Object.entries(deptData.production).forEach(([resource, rate]) => {
                            const efficiency = this.calculateSoftcap(resource, this.resources[resource]);
                            production += rate * efficiency * 3600; // Hourly production
                        });
                    }

                    const roi = production / cost;
                    if (roi > bestROI) {
                        bestROI = roi;
                        bestDept = deptId;
                    }
                });

                if (bestDept && bestROI >= this.automation.departmentAI.roiThreshold) {
                    this.purchaseDepartment(bestDept);
                    this.automation.departmentAI.lastAction = now;
                    this.showNotification(`ü§ñ AI zatrudni≈Ço: ${this.departmentData[bestDept].name} (ROI: ${(bestROI * 100).toFixed(1)}%)`, 'info');
                }
            }

            runTradeBot() {
                if (!this.automation.enabled || !this.automation.tradeBot.active) return;

                const now = Date.now();
                if (now - this.automation.tradeBot.lastAction < 30000) return; // 30s cooldown

                // Look for arbitrage opportunities
                Object.entries(this.fxRates).forEach(([pair, data]) => {
                    const [from, to] = pair.split('_to_');

                    // Simple arbitrage check (real implementation would be more complex)
                    if (data.trend === 'up' && this.resources[from] > 100) {
                        const amount = Math.min(this.resources[from] * 0.1, 1000); // Trade 10% or max 1000
                        if (this.executeTrade(from, to, amount)) {
                            this.automation.tradeBot.lastAction = now;
                            this.showNotification(`ü§ñ Bot wykona≈Ç arbitra≈º: ${from} ‚Üí ${to}`, 'info');
                        }
                    }
                });
            }

            /* =============================================
               TAB SYSTEM
               ============================================= */

            switchTab(tabName) {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Remove active class from all tab buttons
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.classList.remove('active');
                });

                // Show selected tab content
                const tabContent = document.getElementById(`${tabName}-content`);
                if (tabContent) {
                    tabContent.classList.add('active');
                }

                // Activate selected tab button
                const tabButton = document.getElementById(`tab-${tabName}`);
                if (tabButton) {
                    tabButton.classList.add('active');
                }

                this.gameState.currentTab = tabName;
                console.log(`Switched to tab: ${tabName}`);

				// Od≈õwie≈º tylko potrzebny panel
				if (tabName === 'overview') {
					this.updateOverviewTab();
				} else if (tabName === 'human-capital') {
					this.updateHumanCapitalTab();
				} else if (tabName === 'global-markets') {
					this.updateGlobalMarketsTab();
				} else if (tabName === 'trade') {
					this.updateTradeTab();
				} else if (tabName === 'automation') {
					this.updateAutomationTab();
				} else if (tabName === 'minigames') {
					this.updateMinigamesTab();
				}
            }

			produceMarkets() {
				Object.keys(this.regions).forEach(regionKey => {
					const region = this.regions[regionKey];
					if (region.unlocked) {
						const production = this.calculateMarketProduction(regionKey);
						const currencyKey = region.currency.toLowerCase();
						this.resources[currencyKey] = (this.resources[currencyKey] || 0) + production;
					}
				});
			}
			calculateMarketProduction(regionKey) {
				const region = this.regions[regionKey];
				let base = region.level * region.currencyProduction;
				if (this.departments[region.keyDepartment]?.owned > 0) {
					base *= 1.2; // Synergia +20%
				}
				return base;
			}
			upgradeMarket(regionKey) {
			  const region = this.regions[regionKey];
			  if (!region || !region.unlocked) return;

			  if (this.resources.budget >= region.upgradeCost) {
				this.resources.budget -= region.upgradeCost;
				region.level++;
				region.currencyProduction *= 1.2;
				this.updateGlobalMarketsTab();
				this.checkWinCondition();
			  }
			}
			unlockMarket(regionKey) {
			  const region = this.regions[regionKey];
			  if (region.unlocked) return;

			  if (this.resources.budget >= region.upgradeCost) {
				this.resources.budget -= region.upgradeCost;
				region.unlocked = true;
				region.level = 1;
				this.updateGlobalMarketsTab();
				this.checkWinCondition();
			  }
			}

            /* =============================================
               CORE MECHANICS (from 4.2.2)
               ============================================= */

            performMainClick() {
                let clickValue = 2;

                const budgetEfficiency = this.calculateSoftcap('budget', this.resources.budget);
                const stressEffects = this.calculateStressEffects();
                const motivationEffects = this.calculateMotivationEffects();

                const finalValue = clickValue * budgetEfficiency * stressEffects.production * (1 + motivationEffects.productionBonus) * (this.achievementBonuses?.clickPower || 1);

                this.resources.budget += finalValue;
                this.gameState.totalClicks++;

                this.updateClickValueDisplay(finalValue, budgetEfficiency);
                this.animateResourceValue('budget');

                if (Math.random() < 0.1) {
                    this.resources.influence += 0.1;
                }

                this.updateResourceBar();
				this.checkAchievements();
            }

            purchaseDepartment(deptId) {
                const cost = this.getDepartmentCost(deptId);

                if (this.resources.budget >= cost) {
                    this.resources.budget -= cost;
                    this.departments[deptId].owned++;
                    this.updateDepartments();
                    this.updateResourceBar();
                    this.showNotification(`üè¢ Zatrudniono ${this.departmentData[deptId].name}!`, 'success');
                    return true;
                }

                this.showNotification(`üí∞ NiewystarczajƒÖcy bud≈ºet! Potrzebujesz ${cost} üí∞`, 'warning');
                return false;
				this.updateResourceBar();
            }

            getDepartmentCost(deptId) {
                const baseData = this.departmentData[deptId];
                if (!baseData) return 999999;

                const owned = this.departments[deptId].owned;
                return Math.floor(baseData.baseCost * Math.pow(1.25, owned));
				// Apply cost reduction from achievements
				if (this.achievementBonuses && this.achievementBonuses.costReduction) {
					cost *= this.achievementBonuses.costReduction;
				}
            }

            checkDepartmentUnlocks() {
                Object.keys(this.departments).forEach(deptId => {
                    const deptData = this.departmentData[deptId];
                    const dept = this.departments[deptId];

                    if (dept.unlocked) return;

                    let allConditionsMet = true;

                    if (deptData.unlockConditions) {
                        for (const condition of deptData.unlockConditions) {
                            if (condition.type === 'resource') {
                                if (this.resources[condition.resource] < condition.amount) {
                                    allConditionsMet = false;
                                    break;
                                }
                            }
                        }
                    }

                    if (allConditionsMet) {
                        dept.unlocked = true;
                        this.showNotification(`üÜï Odblokowano ${deptData.name}!`, 'success');
                    }
                });
            }

            /* =============================================
               GAME LOOP - Enhanced for Global Operations
               ============================================= */

            triggerRandomEvent() {
				const roll = Math.random();
				if (roll < 0.1) { // 10% szansy na event co tick
					// Przyk≈Çad - event ekonomiczny
					const regions = Object.keys(this.regions);
					const target = regions[Math.floor(Math.random() * regions.length)];
					const change = (Math.random() < 0.5) ? 0.7 : 1.3; // -30% lub +30%
					this.regions[target].currencyProduction *= change;
					setTimeout(() => { // Powr√≥t do normy po 60 sekundach
						this.regions[target].currencyProduction /= change;
					}, 60000);
					showCustomModal(`Wydarzenie globalne: ${getRegionName(target)} ${change < 1 ? "‚Äì kryzys (-30%)" : "‚Äì wzrost (+30%)"} produkcji!`);
				}
			}
			checkForBurnout() {
				if (this.resources.stress >= 180) {
					// Burnout! % szansy na zwolnienie departamentu
					if (Math.random() < 0.12) {
						const depts = Object.keys(this.departments).filter(d=>this.departments[d].owned>0);
						if (!depts.length) return;
						const victim = depts[Math.floor(Math.random() * depts.length)];
						this.departments[victim].owned = Math.max(0, this.departments[victim].owned - 1);
						showCustomModal(`Burnout! Zwolniono 1 osobƒô z dzia≈Çu ${getDepartmentName(victim)}.`);
						this.resources.stress -= 30; // Po zwolnieniu spada dramatycznie stres
					}
				}
			}
			aiAutomationEffect() {
				if (Math.random() < 0.35) {
					// 35% szansy przy ka≈ºdym wywo≈Çaniu
					if (Math.random() < 0.5) {
						this.resources.budget += 100 * (this.automation.level || 1);
						this.resources.motivation = Math.min(100, this.resources.motivation + 10);
						showCustomModal("AI optimizuje koszty! +100 bud≈ºetu, +10 motywacji");
					} else {
						this.resources.stress += 18;
						showCustomModal("AI bug ‚Äì ro≈õnie stres o 18!");
					}
				}
			}
			gameLoop() {
                if (this.gameState.paused) return;

                const now = Date.now();
                const deltaTime = now - this.gameState.lastUpdate;
                this.gameState.lastUpdate = now;
                const deltaSeconds = deltaTime / 1000;

                // Apply game speed
                const motivationEffects = this.calculateMotivationEffects();
                const adjustedDelta = deltaSeconds * motivationEffects.speedBonus * this.gameState.gameSpeed;
                this.updateProduction(adjustedDelta);
                this.applySideEffects(adjustedDelta);
                this.updateFXRates();
                this.runDepartmentAI();
                this.runTradeBot();
				this.checkForBurnout();
				this.produceMarkets();
                this.checkDepartmentUnlocks();
                this.checkRegionUnlocks();
					if (this.automation?.enabled) {
						// Tylko co 500 tick√≥w losowy efekt AI
						this.aiTickCounter = (this.aiTickCounter || 0) + 1;
						if (this.aiTickCounter >= 500) {
							this.aiAutomationEffect();
							this.aiTickCounter = 0;
						}
					}
				this.globalEventTickCounter++;
					if (this.globalEventTickCounter >= 500) {
						this.triggerRandomEvent();
						this.globalEventTickCounter = 0;
					}

				this.globalEventTickCounter = (this.globalEventTickCounter || 0) + 1;
				if (this.globalEventTickCounter >= 500) { // co ok. 1 minutƒô przy 120Hz ticku
					this.triggerRandomEvent();
					this.globalEventTickCounter = 0;
				}
				// Burnout - nie czƒô≈õciej ni≈º co 300 tick√≥w (ok. 30s)
				this.burnoutTickCounter = (this.burnoutTickCounter || 0) + 1;
				if (this.burnoutTickCounter >= 300) {
					this.checkForBurnout();
					this.burnoutTickCounter = 0;
				}
                Object.keys(this.resources).forEach(key => {
					if (isNaN(this.resources[key]) || this.resources[key] < 0) {
						this.resources[key] = 0;
					}
				});
            }

            updateProduction(deltaSeconds) {
                const stressEffects = this.calculateStressEffects();
                const motivationEffects = this.calculateMotivationEffects();

                let totalProductionMultiplier = stressEffects.production * (1 + motivationEffects.productionBonus);

                Object.entries(this.departments).forEach(([deptId, dept]) => {
                    if (dept.owned === 0) return;

                    const deptData = this.departmentData[deptId];
                    if (!deptData || !deptData.production) return;

                    Object.entries(deptData.production).forEach(([resource, rate]) => {
                        const softcapEfficiency = this.calculateSoftcap(resource, this.resources[resource]);
                        const production = rate * dept.owned * totalProductionMultiplier * softcapEfficiency * deltaSeconds;

                        this.resources[resource] = (this.resources[resource] || 0) + production;

                    });
                });
				    const unlockedBefore = Object.values(this.departments).filter(d => d.unlocked).length;
					this.checkDepartmentUnlocks();
					const unlockedAfter = Object.values(this.departments).filter(d => d.unlocked).length;

					// Od≈õwie≈º panel tylko je≈õli unlock rzeczywi≈õcie nastƒÖpi≈Ç
					if (unlockedAfter > unlockedBefore) {
						this.updateOverviewTab();
					}
					this.updateResourceBar();
				}

updateGlobalPresenceCard() {
    const globalCard = document.getElementById('global-presence-card');
    if (!globalCard) return;

    // Aktywne regiony
    const activeRegions = Object.values(this.regions).filter(r => r.unlocked).length;
    const activeRegionsElem = document.getElementById('active-regions');
    if (activeRegionsElem) activeRegionsElem.textContent = activeRegions;

    // Ca≈Çkowita produkcja globalna
    let totalRevenue = Object.values(this.regions).reduce((acc, region) => {
        return acc + (region.unlocked ? region.level * region.currencyProduction : 0);
    }, 0);
    const totalRevenueElem = document.getElementById('total-revenue');
    if (totalRevenueElem) totalRevenueElem.textContent = totalRevenue.toFixed(2);

    // Globalny poziom
    let globalLevel = 1;
    if (activeRegions > 0) {
        globalLevel = Math.floor(
            Object.values(this.regions)
                .filter(r => r.unlocked)
                .reduce((acc, region) => acc + (region.level || 1), 0) / activeRegions
        );
    }
    const globalLevelElem = document.getElementById('global-level');
    if (globalLevelElem) globalLevelElem.textContent = globalLevel;

    // Lista region√≥w
    let regionListHTML = '';
    Object.entries(this.regions).forEach(([key, region]) => {
        if(region.unlocked) {
            regionListHTML += `<span style="margin-right:10px">${getRegionFlag(key)} <b>${getRegionName(key)}</b> (lv.${region.level || 1})</span>`;
        }
    });
    const regionsListElem = document.getElementById('regions-list');
    if (regionsListElem) regionsListElem.innerHTML = regionListHTML || '<i>Brak aktywnych region√≥w</i>';

    // Progress bar
    const progressBarElem = document.getElementById('global-progress-bar');
    const progressValueElem = document.getElementById('global-progress-value');
    if (progressBarElem && progressValueElem) {
      progressBarElem.max = Object.keys(this.regions).length;
      progressBarElem.value = activeRegions;
      progressValueElem.textContent = `${activeRegions}/${Object.keys(this.regions).length}`;
    }

    // SVG "mapa"
    Object.entries(this.regions).forEach(([key, region]) => {
        const svgRegion = document.getElementById('map-' + key.replace('-', ''));
        if (svgRegion) svgRegion.setAttribute('opacity', region.unlocked ? '1' : '0.2');
    });
}
            applySideEffects(deltaSeconds) {
                // Department side effects
                Object.entries(this.departments).forEach(([deptId, dept]) => {
                    if (dept.owned === 0) return;

                    const deptData = this.departmentData[deptId];
                    if (!deptData || !deptData.sideEffects) return;

                    Object.entries(deptData.sideEffects).forEach(([resource, rate]) => {
                        const effect = rate * dept.owned * deltaSeconds;
                        this.resources[resource] = (this.resources[resource] || 0) + effect;
                    });
                });

                // Natural stress/motivation changes
                this.resources.stress = Math.max(0, this.resources.stress - 0.2 * deltaSeconds);

                if (this.resources.motivation > 50) {
                    this.resources.motivation -= 0.15 * deltaSeconds;
                } else if (this.resources.motivation < 50) {
                    this.resources.motivation += 0.05 * deltaSeconds;
                }

                // Constrain values
                this.resources.stress = Math.max(0, Math.min(200, this.resources.stress));
                this.resources.motivation = Math.max(-50, Math.min(100, this.resources.motivation));
				this.updateResourceBar();
            }

            /* =============================================
               DISPLAY UPDATES - Modern UI System
               ============================================= */


            updateDisplay() {
                this.updateResourceBar();
                this.updateOverviewTab();
                this.updateHumanCapitalTab();
                this.updateGlobalMarketsTab();
                this.updateTradeTab();
                this.updateAutomationTab();
                this.updateMinigamesTab();
            }

            updateResourceBar() {
                const resources = ['budget', 'documents', 'coffee', 'prestige', 'usd', 'eur', 'jpy', 'cny', 'freight'];

                resources.forEach(resource => {
                    const element = document.getElementById(resource);
                    if (element) {
                        const value = Math.floor(this.resources[resource] || 0);
                        element.textContent = this.formatNumber(value);
                    }

                    // Update efficiency indicators
                    const efficiencyElement = document.getElementById(`${resource}-efficiency`);
                    if (efficiencyElement && this.softcapThresholds[resource]) {
                        const efficiency = this.calculateSoftcap(resource, this.resources[resource]);
                        const efficiencyPercent = Math.round(efficiency * 100);

                        efficiencyElement.textContent = `${efficiencyPercent}%`;

                        // Update efficiency class
                        efficiencyElement.className = 'resource-efficiency ';
                        if (efficiency >= 0.9) {
                            efficiencyElement.className += 'efficiency-optimal';
                        } else if (efficiency >= 0.6) {
                            efficiencyElement.className += 'efficiency-moderate';
                        } else {
                            efficiencyElement.className += 'efficiency-poor';
                        }
                    }
                });
				const productionGains = {
				  budget: 0,
				  documents: 0,
				  coffee: 0,
				  prestige: 0,
				};
				this.gameState.maxStress = Math.max(this.gameState.maxStress || 0, this.resources.stress);
				this.gameState.maxMotivation = Math.max(this.gameState.maxMotivation || 0, this.resources.motivation);
			Object.keys(productionGains).forEach(resource => {
				this.gameState.totalProduced[resource] = (this.gameState.totalProduced[resource] || 0) + productionGains[resource];
			});
			}

 updateOverviewTab() {

	// Update departments overview
    const container = document.getElementById('departments-overview');
    if (!container) return;

    container.innerHTML = '';

    Object.entries(this.departmentData).forEach(([deptId, deptData]) => {
        const dept = this.departments[deptId];

        const card = document.createElement('div');
        card.className = `department-card card ${dept.unlocked ? 'unlocked' : 'locked'}`;

        card.innerHTML = `
            <div class="department-header">
                <div class="department-title">
                    <span>${deptData.icon}</span>
                    ${deptData.name}
                </div>
            </div>
            <div class="department-body">
                <div class="department-description">${deptData.description}</div>
                <div class="department-effects"></div>
                <div class="department-unlock-conditions"></div>
                <div class="department-stats">
                    <div class="stat-item">
                        <div class="stat-label">
						  Zatrudnienie
						  <span class="tooltip-icon" tabindex="0">?
							<span class="tooltip-text">
							  <b>Co oznacza 'Zatrudnienie'?</b><br>
							  Liczba aktualnie zatrudnionych jednostek tego dzia≈Çu.<br>
							  Ka≈ºda zatrudniona jednostka zwiƒôksza efekty dzia≈Çania.<br>
							  Im wiƒôcej zatrudnionych, tym wiƒôkszy poziom oraz wzrost efekt√≥w, ale ro≈õnie te≈º koszt kolejnych zatrudnie≈Ñ!
							</span>
						  </span>
						</div>
                        <div class="stat-value">${dept.owned}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">
                            Koszt (Bud≈ºet)
                            <span class="tooltip-icon" tabindex="0">?
                              <span class="tooltip-text">
                                <b>Co oznacza Koszt?</b><br>
                                Musisz posiadaƒá wystarczajƒÖcy <b>Bud≈ºet</b>, aby zatrudniƒá kolejnƒÖ jednostkƒô tego dzia≈Çu.<br>
                                Koszt ro≈õnie ze wzrostem liczby zatrudnionych!
                              </span>
                            </span>
                        </div>
                        <div class="stat-value">${this.formatNumber(this.getDepartmentCost(deptId))}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">
                            Poziom
                            <span class="tooltip-icon" tabindex="0">?
                              <span class="tooltip-text">
                                <b>Jak liczony jest poziom?</b><br>
                                Poziom danego dzia≈Çu zwiƒôksza siƒô coraz wolniej:<br>
                                <code>poziom = 1 + ‚åälog‚ÇÇ(liczba zatrudnionych + 1)‚åã</code>.<br>
                                Wy≈ºszy poziom umo≈ºliwia wiƒôkszƒÖ produkcjƒô i dodatkowe efekty!
                              </span>
                            </span>
                        </div>
                        <div class="stat-value">${dept.owned > 0 ? Math.floor(Math.log2(dept.owned + 1)) + 1 : 1}</div>
                    </div>
                </div>
                <button class="department-button" ${dept.unlocked && this.resources.budget >= this.getDepartmentCost(deptId) ? '' : 'disabled'}>
                    ${dept.unlocked ? 'Zatrudnij' : 'Zablokowane'}
                </button>
            </div>
        `;

        // --- SEKRETNE EFEKTY DZIA≈ÅU: PRODUKCJA I EFEKTY UBOCZNE ---
        let effectHtml = '<div><span class="effects-title">Efekty zatrudniania:</span>';
        if (deptData.production) {
            Object.entries(deptData.production).forEach(([res, val]) => {
                effectHtml += `<div class="effect-item effect-positive">+${val} ${this.formatResourceName(res)} / poziom</div>`;
            });
        }
        if (deptData.sideEffects) {
            Object.entries(deptData.sideEffects).forEach(([res, val]) => {
                effectHtml += `<div class="effect-item effect-negative">${val > 0 ? '+' : ''}${val} ${this.formatResourceName(res)} / poziom</div>`;
            });
        }
        effectHtml += '</div>';
        card.querySelector('.department-effects').innerHTML = effectHtml;

        // --- WARUNKI ODBLOKOWANIA DLA BLOKOWANEGO DZIA≈ÅU ---
        let unlockHtml = '';
        if (!dept.unlocked && deptData.unlockConditions && deptData.unlockConditions.length) {
            unlockHtml = '<div class="department-unlock"><span class="effects-title">Aby odblokowaƒá:</span><ul>';
            deptData.unlockConditions.forEach(cond => {
                if (cond.type === "resource") {
                    unlockHtml += `<li>${cond.amount} ${this.formatResourceName(cond.resource)}</li>`;
                }
            });
            unlockHtml += '</ul></div>';
        }
        if (!dept.unlocked && (!deptData.unlockConditions || !deptData.unlockConditions.length)) {
            unlockHtml = '<div class="department-unlock">Dostƒôpny od poczƒÖtku gry</div>';
        }
        card.querySelector('.department-unlock-conditions').innerHTML = unlockHtml;

        if (dept.unlocked) {
            const button = card.querySelector('button');
            button.addEventListener('click', () => this.purchaseDepartment(deptId));
        }

        container.appendChild(card);
    });

    // Update global stats
    const activeRegions = Object.values(this.regions).filter(r => r.unlocked).length;
    const totalRevenue = this.resources.budget + this.resources.usd * 4 + this.resources.eur * 4.3;
    const globalLevel = Math.floor(totalRevenue / 1000) + 1;

    //document.getElementById('active-regions').textContent = activeRegions;
    //document.getElementById('total-revenue').textContent = this.formatNumber(totalRevenue);
    //document.getElementById('global-level').textContent = globalLevel;
}


			hireDepartment(deptId) {
			  const dept = this.departments[deptId];
			  if (!dept) return;
			  const cost = this.calculateDepartmentCost(deptId); // <-- dynamicznie!
			  if (this.resources.budget >= cost) {
				this.resources.budget -= cost;
				dept.owned++;
				dept.level = dept.owned;
				this.updateDepartments();
				this.updateOverviewTab();
				this.updateResourceBar();
				this.checkAchievements();
			  }
			}

			// Funkcja aktualizujƒÖca wy≈õwietlanie kart departament√≥w:
			updateDepartments() {
			  const container = document.getElementById('departments-overview');
			  if(!container) return;
			  container.innerHTML = '';
			  Object.entries(this.departments).forEach(([deptId, deptData]) => {
				// Zak≈Çadam, ≈ºe masz funkcjƒô do wyliczania kosztu zatrudnienia:
				const nextCost = this.calculateDepartmentCost
				  ? this.calculateDepartmentCost(deptId)
				  : (deptData.baseCost || 100) * Math.pow(1.15, deptData.owned || 0); // fallback

				const card = document.createElement('div');
				card.className = 'department-card';
				card.innerHTML = `
				  <div class="dept-title">${deptData.name}</div>
				  <div>Liczba zatrudnionych: ${deptData.owned}</div>
				  <div>Poziom: ${deptData.level || 1}</div>
				  <button onclick="game.hireDepartment('${deptId}')">
					Zatrudnij (koszt: ${Math.floor(nextCost)} üí∞)
				  </button>
				`;
				container.appendChild(card);
			  });
			  game.updateOverviewTab();
			}

			updateHumanCapitalTab() {
                // Update stress progress
                const stressBar = document.getElementById('stress-progress');
                const stressPercentage = document.getElementById('stress-percentage');
                const stressEffectsElement = document.getElementById('stress-effects');
                const stressValue = document.getElementById('stress');

                if (stressBar && stressValue) {
                    const stressPercent = (this.resources.stress / 200) * 100;
                    stressBar.style.width = `${Math.min(stressPercent, 100)}%`;
                    stressValue.textContent = Math.floor(this.resources.stress);

                    if (stressPercentage) {
                        stressPercentage.textContent = `${Math.round(stressPercent)}%`;
                    }
                }

                if (stressEffectsElement) {
                    const effects = this.calculateStressEffects();
                    stressEffectsElement.innerHTML = `
                        Produkcja: ${Math.round(effects.production * 100)}% ‚Ä¢
                        Jako≈õƒá: ${Math.round(effects.quality * 100)}% ‚Ä¢
                        Ryzyko rezygnacji: ${Math.round(effects.quitChance * 100)}%
                    `;
                }

                // Update motivation progress
                const motivationBar = document.getElementById('motivation-progress');
                const motivationPercentage = document.getElementById('motivation-percentage');
                const motivationEffectsElement = document.getElementById('motivation-effects');
                const motivationValue = document.getElementById('motivation');

                if (motivationBar && motivationValue) {
                    const motivationPercent = ((this.resources.motivation + 50) / 150) * 100;
                    motivationBar.style.width = `${Math.max(0, Math.min(motivationPercent, 100))}%`;
                    motivationValue.textContent = Math.floor(this.resources.motivation);

                    if (motivationPercentage) {
                        motivationPercentage.textContent = `${Math.round(motivationPercent)}%`;
                    }
                }

                if (motivationEffectsElement) {
                    const effects = this.calculateMotivationEffects();
                    const bonus = effects.productionBonus * 100;
                    const speed = effects.speedBonus;

                    motivationEffectsElement.innerHTML = `
                        Bonus produkcji: ${bonus > 0 ? '+' : ''}${Math.round(bonus)}% ‚Ä¢
                        Przyspieszenie: ${speed === 1 ? 'Normalne' : `${speed.toFixed(1)}x`}
                    `;
                }
				const coffeeBtn = document.getElementById("coffee-break-btn");
				if (coffeeBtn) {
				  coffeeBtn.onclick = function() {
					if (game.resources.coffee >= 50) {
					  game.resources.coffee -= 50;
					  game.resources.stress = Math.max(0, game.resources.stress - 20);
					  game.resources.motivation = Math.min(100, game.resources.motivation + 10);
					  if (game.gameState) game.gameState.coffeeBreaks = (game.gameState.coffeeBreaks || 0) + 1;
					  game.updateResourceBar();
					  game.updateHumanCapitalTab();
					  game.checkAchievements();
					  // Dodaj POPUP po sukcesie
					  openCoffeePopup("Ekipa siƒô relaksuje: -20 stresu, +10 motywacji!");
					} else {
					  openCoffeePopup("Nie masz wystarczajƒÖco kawy! (min. 50)");
					}
				  }
				}
				function openCoffeePopup(msg) {
				  document.getElementById('coffee-popup-msg').textContent = msg;
				  document.getElementById('coffee-popup').classList.remove('hidden');
				}
				function closeCoffeePopup() {
				  document.getElementById('coffee-popup').classList.add('hidden');
				}
            }

			updateGlobalMarketsTab() {
			  const container = document.getElementById('region-cards-container');
			  container.innerHTML = ''; // wyczy≈õƒá!

			  Object.entries(this.regions).forEach(([regionKey, region]) => {
				// Dynamiczne klasy / napisy
				const locked = !region.unlocked;
				const currencySymbol = getCurrencySymbol(region.currency); // np. "‚Ç¨", "$" itd.
				const regionName = getRegionName(regionKey); // np. "Europa", "Ameryki" itd.

				// Przyciski
				let actionBtn = '';
				if (!region.unlocked && region.upgradeCost) {
				  // Przycisk do odblokowania
				  actionBtn = `<button class="market-upgrade-btn" onclick="game.unlockMarket('${regionKey}')">Otw√≥rz rynek (${region.upgradeCost} üí∞)</button>`;
				} else if (region.unlocked) {
				  let tooltip = '';
					if (region.keyDepartment) {
						tooltip = `Synergia ‚Äì za aktywny dzia≈Ç ${getDepartmentName(region.keyDepartment)}: +20% produkcji na tym rynku.`;
					}
					// Przycisk do rozwoju rynku
				  actionBtn = `<button class="market-upgrade-btn" title="${tooltip}" onclick="game.upgradeMarket('${regionKey}')">Rozwijaj rynek (koszt: ${region.upgradeCost} üí∞)</button>`;
				}

				// Aktualna produkcja, poziom, pracownicy itd.
				container.innerHTML += `
				  <div class="region-card card${locked ? ' locked' : ''}" data-region="${regionKey}">
					<div class="region-header">
					  <h3 class="region-title">${getRegionFlag(regionKey)} ${regionName}</h3>
					  <div class="region-status">${locked ? `Wymaga: ${region.upgradeCost} üí∞` : 'Odblokowane'}</div>
					</div>
					<div class="card-content">
					  <div class="region-stats">
						<div class="stat-item">
						  <div class="stat-label">Przychody</div>
						  <div class="stat-value">${currencySymbol}${(region.level * region.currencyProduction).toFixed(2)}</div>
						</div>
						<div class="stat-item">
						  <div class="stat-label">Pracownicy</div>
						  <div class="stat-value">${region.employees || 0}</div>
						</div>
						<div class="stat-item">
						  <div class="stat-label">Poziom</div>
						  <div class="stat-value">${region.level || 0}</div>
						</div>
					  </div>
					  ${actionBtn}
					</div>
				  </div>
				`;
			  });
			}


            updateTradeTab() {
                // Update FX rates display
                const fxContainer = document.getElementById('fx-rates');
                if (!fxContainer) return;

                fxContainer.innerHTML = '';

                Object.entries(this.fxRates).forEach(([pair, data]) => {
                    const [from, to] = pair.split('_to_');

                    const pairElement = document.createElement('div');
                    pairElement.className = 'fx-pair';
                    pairElement.onclick = () => this.openTradeDialog(from, to);

                    const trendIcon = data.trend === 'up' ? '‚Üó' : data.trend === 'down' ? '‚Üò' : '‚ü∑';
                    const trendText = data.trend === 'up' ? 'Ro≈õnie' : data.trend === 'down' ? 'Spada' : 'Stabilny';

                    pairElement.innerHTML = `
                        <div class="fx-pair-name">${from.toUpperCase()}/${to.toUpperCase()}</div>
                        <div class="fx-rate">${data.rate.toFixed(3)}</div>
                        <div class="fx-trend trend-${data.trend}">${trendIcon} ${trendText}</div>
                    `;

                    fxContainer.appendChild(pairElement);
                });
            }

updateAutomationTab() {
    // BLOKADA: Sprawd≈∫, czy przynajmniej 1 region poza EuropƒÖ jest odblokowany
    const otherRegions = Object.entries(this.regions).filter(([regionId, region]) =>
        regionId !== "europe" && region.unlocked
    );
    const canShowAutomation = otherRegions.length > 0;

    const automationContent = document.getElementById('automation-content');
    if (automationContent && !canShowAutomation) {
        automationContent.innerHTML =
            '<div class="automation-locked" style="padding: 2rem; color: #ff9800; font-weight: 600">Odblokuj przynajmniej jeden nowy rynek poza EuropƒÖ, by uzyskaƒá dostƒôp do automatyzacji AI.</div>';
        return;
    }

    // Update AI agent statuses
    const deptStatus = document.getElementById('dept-ai-status');
    const tradeStatus = document.getElementById('trade-ai-status');
    const expansionStatus = document.getElementById('expansion-ai-status');

    if (deptStatus) {
        deptStatus.className = `agent-status ${this.automation.departmentAI.active ? '' : 'inactive'}`;
    }
    if (tradeStatus) {
        tradeStatus.className = `agent-status ${this.automation.tradeBot.active ? '' : 'inactive'}`;
    }
    if (expansionStatus) {
        expansionStatus.className = `agent-status ${this.automation.expansionAI.active ? '' : 'inactive'}`;
    }

    // Update threshold displays
    const deptROIDisplay = document.getElementById('dept-roi-display');
    const tradeArbitrageDisplay = document.getElementById('trade-arbitrage-display');

    if (deptROIDisplay) {
        const threshold = document.getElementById('dept-roi-threshold');
        if (threshold) {
            this.automation.departmentAI.roiThreshold = parseFloat(threshold.value) / 100;
            deptROIDisplay.textContent = `${threshold.value}%`;
        }
    }

    if (tradeArbitrageDisplay) {
        const threshold = document.getElementById('trade-arbitrage-threshold');
        if (threshold) {
            this.automation.tradeBot.arbitrageThreshold = parseFloat(threshold.value) / 100;
            tradeArbitrageDisplay.textContent = `${threshold.value}%`;
        }
    }
}

            updateMinigamesTab() {
                const container = document.getElementById('minigames-grid');
                if (!container) return;

                container.innerHTML = '';

                Object.entries(this.minigameData).forEach(([gameId, gameData]) => {
                    const isUnlocked = gameData.unlocked();
                    const lastPlayed = this.gameState.minigameCooldowns[gameId] || 0;
                    const cooldownRemaining = gameData.cooldown - (Date.now() - lastPlayed);
                    const onCooldown = cooldownRemaining > 0;

                    const card = document.createElement('div');
                    card.className = `card ${isUnlocked ? 'unlocked' : 'locked'}`;

                    const costText = Object.entries(gameData.cost)
                        .map(([resource, amount]) => `${amount} ${this.formatResourceName(resource)}`)
                        .join(', ');

                    const successRewards = Object.entries(gameData.rewards.success)
                        .map(([reward, value]) => `${reward}: +${value}`)
                        .join(', ');

                    let buttonText, buttonClass = '';

                    if (!isUnlocked) {
                        buttonText = 'Zablokowane';
                        buttonClass = 'disabled';
                    } else if (onCooldown) {
                        buttonText = `Cooldown: ${Math.ceil(cooldownRemaining / 60000)}min`;
                        buttonClass = 'disabled';
                    } else {
                        buttonText = 'Zagraj Teraz';
                    }

                    card.innerHTML = `
                        <div class="card-header">
                            <h3 class="card-title">
                                <span>${gameData.icon}</span>
                                ${gameData.name}
                            </h3>
                        </div>
                        <div class="card-content">
                            <div style="background: rgba(156, 39, 176, 0.1); padding: var(--space-3); border-radius: var(--radius-md); margin-bottom: var(--space-3); font-size: var(--text-sm); font-weight: 600; color: var(--accent-purple);">
                                üí∏ Koszt: ${costText}
                            </div>

                            <div style="font-size: var(--text-sm); color: var(--text-muted); margin-bottom: var(--space-4); line-height: 1.5;">
                                ${gameData.description}
                            </div>

                            <div style="background: rgba(76, 175, 80, 0.1); padding: var(--space-3); border-radius: var(--radius-md); margin-bottom: var(--space-4); border-left: 3px solid var(--accent-success); font-size: var(--text-sm); color: var(--accent-success);">
                                üéÅ Nagrody za sukces: ${successRewards}
                            </div>

                            <button class="department-button ${buttonClass}" ${buttonClass.includes('disabled') ? 'disabled' : ''}>
                                ${buttonText}
                            </button>
                        </div>
                    `;

                    // Add event listener
                    if (isUnlocked && !onCooldown && !buttonClass.includes('disabled')) {
                        const button = card.querySelector('button');
                        button.addEventListener('click', () => this.openMinigame(gameId));
                    }

                    container.appendChild(card);
                });
            }

            /* =============================================
               UTILITY FUNCTIONS
               ============================================= */

            formatNumber(num) {
                if (Math.abs(num) >= 1e12) return (num / 1e12).toFixed(2) + 'T';
                if (Math.abs(num) >= 1e9) return (num / 1e9).toFixed(2) + 'B';
                if (Math.abs(num) >= 1e6) return (num / 1e6).toFixed(2) + 'M';
                if (Math.abs(num) >= 1e3) return (num / 1e3).toFixed(2) + 'K';
                return Math.floor(num).toString();
            }

            formatResourceName(resourceId) {
                const names = {
                    budget: 'üí∞ Bud≈ºet',
                    documents: 'üìÑ Dokumenty',
                    coffee: '‚òï Kawa',
                    prestige: 'üéñÔ∏è Presti≈º',
                    usd: 'üíµ USD',
                    eur: 'üí∂ EUR',
                    jpy: 'üí¥ JPY',
                    cny: 'üí∑ CNY',
                    freight: 'üì¶ Freight'
                };
                return names[resourceId] || resourceId;
            }

            animateResourceValue(resource) {
                const element = document.getElementById(resource);
                if (element) {
                    element.style.animation = 'none';
                    setTimeout(() => {
                        element.style.animation = 'pulse 0.6s ease';
                    }, 10);
                }
            }

            showNotification(message, type = 'info', duration = 3000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideInRight 0.4s ease reverse';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.parentElement.removeChild(notification);
                        }
                    }, 400);
                }, duration);
            }

            updateClickValueDisplay(finalValue, efficiency) {
                const clickValueElement = document.getElementById('click-value');
                const clickEfficiencyElement = document.getElementById('click-efficiency');

                if (clickValueElement) {
                    clickValueElement.textContent = finalValue.toFixed(1);
                }

                if (clickEfficiencyElement) {
                    clickEfficiencyElement.textContent = `${Math.round(efficiency * 100)}%`;
                }
            }
			calculateGlobalIncome() {
				return Object.values(this.regions).reduce((acc, region) =>
				  acc + (region.unlocked ? (region.level * region.currencyProduction) : 0), 0);
			}
			calculateGlobalLevel() {
				let unlocked = Object.values(this.regions).filter(r=>r.unlocked);
				if(!unlocked.length) return 1;
				return Math.floor(unlocked.reduce((acc,region) => acc+(region.level||0),0)/unlocked.length);
			}
            /* =============================================
               DIALOG SYSTEMS
               ============================================= */

            openTradeDialog(from, to) {
                const rate = this.fxRates[`${from}_to_${to}`]?.rate || 0.1;
                const amount = prompt(`Ile ${from} chcesz wymieniƒá na ${to}?\nAktualny kurs: 1:${rate.toFixed(3)}\nOp≈Çata transakcyjna: 1%`);

                if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
                    this.executeTrade(from, to, parseFloat(amount));
                }
            }

            openMinigame(gameId) {
                const gameData = this.minigameData[gameId];
                if (!gameData || !gameData.unlocked()) {
                    this.showNotification('Mini-gra jeszcze nie odblokowana!', 'warning');
                    return;
                }

                // Check cooldown
                const lastPlayed = this.gameState.minigameCooldowns[gameId] || 0;
                const cooldownRemaining = gameData.cooldown - (Date.now() - lastPlayed);

                if (cooldownRemaining > 0) {
                    const minutes = Math.ceil(cooldownRemaining / 60000);
                    this.showNotification(`‚è±Ô∏è Cooldown: ${minutes} minut`, 'warning');
                    return;
                }

                // Check costs
                let canAfford = true;
                const costText = [];

                Object.entries(gameData.cost).forEach(([resource, amount]) => {
                    if (this.resources[resource] < amount) {
                        canAfford = false;
                    }
                    costText.push(`${amount} ${this.formatResourceName(resource)}`);
                });

                if (!canAfford) {
                    this.showNotification(`NiewystarczajƒÖce zasoby! Potrzebujesz: ${costText.join(', ')}`, 'warning');
                    return;
                }

                // Start minigame
                this.startMinigame(gameId);
            }

            startMinigame(gameId) {
                const gameData = this.minigameData[gameId];

                // Deduct costs
                Object.entries(gameData.cost).forEach(([resource, amount]) => {
                    this.resources[resource] -= amount;
                });

                console.log(`üéÆ Starting minigame: ${gameId}`);

                const costText = Object.entries(gameData.cost)
                    .map(([resource, amount]) => `${amount} ${this.formatResourceName(resource)}`)
                    .join(', ');

                this.showNotification(`üéÆ ${gameData.name} - Koszt: ${costText}. Naci≈õnij SPACE aby wygraƒá!`, 'info', 5000);

                let completed = false;

                const completeGame = (result) => {
                    if (completed) return;
                    completed = true;

                    document.removeEventListener('keydown', keyHandler);
                    this.completeMinigame(gameId, result);
                };

                const keyHandler = (e) => {
                    if (e.code === 'Space' || e.key === ' ') {
                        e.preventDefault();
                        completeGame(true);
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        completeGame(false);
                    }
                };

                document.addEventListener('keydown', keyHandler);

                // Success chances
                const successChances = {
                    quarterly_presentation: 0.75,
                    barista_championship: 0.65,
                    corporate_merger: 0.55,
                    government_lobbying: 0.45,
                    global_summit: 0.60
                };

                const successChance = successChances[gameId] || 0.7;

                setTimeout(() => {
                    completeGame(Math.random() < successChance);
                }, 5000);
            }

            completeMinigame(gameId, success) {
                const gameData = this.minigameData[gameId];
                const rewards = success ? gameData.rewards.success : gameData.rewards.failure;

                if (success) {
                    this.showNotification(`üéâ ${gameData.name} - SUKCES!`, 'success');

                    Object.entries(rewards).forEach(([reward, value]) => {
                        this.applyMinigameReward(reward, value);
                    });

                } else {
                    this.showNotification(`üòû ${gameData.name} - PORA≈ªKA!`, 'error');

                    Object.entries(rewards).forEach(([penalty, value]) => {
                        this.applyMinigamePenalty(penalty, value);
                    });
                }

                // Set cooldown
                this.gameState.minigameCooldowns[gameId] = Date.now();

                this.updateResourceBar();
            }

            applyMinigameReward(reward, value) {
                switch(reward) {
                    case 'budget':
                    case 'documents':
                    case 'coffee':
                    case 'prestige':
                    case 'usd':
                    case 'eur':
                    case 'jpy':
                    case 'cny':
                    case 'freight':
                        this.resources[reward] += value;
                        break;
                    case 'global_expansion_bonus':
                        this.gameState.activeEffects.globalExpansionBonus = value;
                        break;
                    case 'softcap_increase':
                        Object.keys(this.softcapThresholds).forEach(resource => {
                            this.softcapThresholds[resource] = this.softcapThresholds[resource].map(t => t * (1 + value));
                        });
                        break;
                }
				this.updateResourceBar();
            }

            applyMinigamePenalty(penalty, value) {
                switch(penalty) {
                    case 'budget_loss_percent':
                        this.resources.budget *= (1 - value);
                        break;
                    case 'stress':
                        this.resources.stress += value;
                        break;
                    case 'motivation':
                        this.resources.motivation += value;
                        break;
                    case 'reputation_loss':
                        this.resources.prestige = Math.max(0, this.resources.prestige - value * 10);
                        break;
                }
				this.updateResourceBar();
            }
			/* =============================================
               VICTORY Conditions
               ============================================= */

			checkWinCondition() {
				// Warunek: wszystkie regiony odblokowane i lvl >= 5
				const allRegions = Object.values(this.regions);
				const allUnlocked = allRegions.every(region => region.unlocked);
				const allHighLevel = allRegions.every(region => region.unlocked && region.level >= 5);

				if (allUnlocked && allHighLevel) {
					this.showVictoryModal();
					this.isGameWon = true; // Dodaj w konstruktorze this.isGameWon = false;
				}
			}
			showVictoryModal() {
				showCustomModal("Gratulacje! Zdominowa≈Çe≈õ ≈õwiat globalnego rynku!\n‚àö Wszystkie regiony 5+ lvl\n‚àö Pe≈Çny sukces!\nSpecjalna minigra odblokowana ‚úàÔ∏èüåé");
				// Tu mo≈ºesz te≈º prze≈ÇƒÖczyƒá na endgame/minigrƒô, nagrody prestige itp.
			}
            /* =============================================
               EVENT HANDLERS
               ============================================= */

            setupEventHandlers() {
                // Main click button
                const mainButton = document.getElementById('main-click-button');
                if (mainButton) {
                    mainButton.addEventListener('click', () => this.performMainClick());
                }

                // Control buttons
                const saveButton = document.getElementById('save-game');
                const resetButton = document.getElementById('reset-game');
                const exportButton = document.getElementById('export-data');

                if (saveButton) saveButton.addEventListener('click', () => this.saveGame());
                if (resetButton) resetButton.addEventListener('click', () => this.resetGame());
                if (exportButton) exportButton.addEventListener('click', () => this.exportData());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && !e.ctrlKey && !e.altKey && !document.activeElement.tagName.match(/INPUT|TEXTAREA/)) {
                        e.preventDefault();
                        this.performMainClick();
                    }

                    // Tab navigation
                    if (e.key >= '1' && e.key <= '6' && e.ctrlKey) {
                        e.preventDefault();
                        const tabs = ['overview', 'human-capital', 'global-markets', 'trade', 'automation', 'minigames'];
                        const tabIndex = parseInt(e.key) - 1;
                        if (tabs[tabIndex]) {
                            switchTab(tabs[tabIndex]);
                        }
                    }
                });

                console.log('‚úÖ Event handlers attached for Phase 4.3');
            }

            /* =============================================
               SAVE/LOAD SYSTEM - Enhanced for Global Data
               ============================================= */

            saveGame() {
                try {
                    const saveData = {
                        version: this.version,
                        resources: this.resources,
                        departments: this.departments,
                        regions: this.regions,
                        fxRates: this.fxRates,
                        automation: this.automation,
                        gameState: this.gameState,
                        timestamp: Date.now(),
						achievements: this.achievements,
						achievementBonuses: this.achievementBonuses,
						gameState: this.gameState  // Make sure this includes all new properties
                    };

                    localStorage.setItem('corpoclicker_phase43_save', JSON.stringify(saveData));
                    this.showNotification('üíæ Gra zapisana pomy≈õlnie!', 'success');
                } catch (error) {
                    this.showNotification('‚ùå B≈ÇƒÖd podczas zapisu!', 'error');
                    console.error('Save failed:', error);
                }
            }

            loadGame() {
                try {
                    let saved = localStorage.getItem('corpoclicker_phase43_save');

                    // Backwards compatibility
                    if (!saved) {
                        saved = localStorage.getItem('corpoclicker_phase422_save') ||
                                localStorage.getItem('corpoclicker_phase421_save') ||
                                localStorage.getItem('corpoclicker_phase42_save');
                    }

                    if (saved) {
                        const saveData = JSON.parse(saved);

                        // Migrate resources
                        this.resources = { ...this.resources, ...saveData.resources };
                        this.departments = { ...this.departments, ...saveData.departments };

                        // New data (might not exist in older saves)
                        if (saveData.regions) {
                            this.regions = { ...this.regions, ...saveData.regions };
                        }
                        if (saveData.fxRates) {
                            this.fxRates = { ...this.fxRates, ...saveData.fxRates };
                        }
                        if (saveData.automation) {
                            this.automation = { ...this.automation, ...saveData.automation };
                        }
                        if (saveData.gameState) {
                            this.gameState = { ...this.gameState, ...saveData.gameState };
                        }

                        console.log('üìÅ Phase 4.3 game loaded successfully');
                        return true;
                    }

                } catch (error) {
                    console.error('Load failed:', error);
                }
                return false;
				                    if (saveData.achievements) this.achievements = saveData.achievements;
					if (saveData.achievementBonuses) this.achievementBonuses = saveData.achievementBonuses;
            }

            resetGame() {
                if (confirm('Czy na pewno chcesz zresetowaƒá grƒô? Wszystkie postƒôpy zostanƒÖ utracone!')) {
                    ['corpoclicker_phase43_save', 'corpoclicker_phase422_save', 'corpoclicker_phase421_save', 'corpoclicker_phase42_save'].forEach(key => {
                        localStorage.removeItem(key);
                    });
                    this.showNotification('Gra zostanie zresetowana za 3 sekundy...', 'warning', 3000);
                    setTimeout(() => window.location.reload(), 3000);
                }
            }

            exportData() {
                try {
                    const exportData = {
                        version: this.version,
                        resources: this.resources,
                        departments: this.departments,
                        regions: this.regions,
                        fxRates: this.fxRates,
                        automation: this.automation,
                        gameState: this.gameState,
                        exportTime: new Date().toISOString()
                    };

                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});

                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `corpoclicker_phase43_${Date.now()}.json`;
                    link.click();

                    this.showNotification('üì§ Dane wyeksportowane!', 'success');
                } catch (error) {
                    this.showNotification('‚ùå B≈ÇƒÖd podczas eksportu!', 'error');
                }
            }

            /* =============================================
               INITIALIZATION
               ============================================= */

            init() {
                console.log('üîß Initializing Phase 4.3 systems...');

                // Load saved game
                this.loadGame();

                // Setup event handlers
                this.setupEventHandlers();

                // Start game loop
                setInterval(() => this.gameLoop(), 100);

                // Initialize displays
                this.updateDisplay();

                console.log('‚úÖ CorpoClicker Phase 4.4 - Corporate Empire initialized!');

                // Welcome message
                setTimeout(() => {
                    this.showNotification('üåç Witaj w grze korposzczur!', 'success');
                }, 1000);
            }
        }

        // Global functions for UI interactions
        function switchTab(tabName) {
            if (window.game) {
                window.game.switchTab(tabName);
            }
        }

        function toggleMasterAutomation() {
            if (window.game) {
                window.game.toggleMasterAutomation();
            }
        }

        function toggleDepartmentAI() {
            if (window.game) {
                window.game.automation.departmentAI.active = !window.game.automation.departmentAI.active;
                window.game.updateAutomationTab();
                const button = event.target;
                button.textContent = window.game.automation.departmentAI.active ? 'Aktywny' : 'Nieaktywny';
                button.classList.toggle('active', window.game.automation.departmentAI.active);
            }
        }

        function toggleTradeBot() {
            if (window.game) {
                window.game.automation.tradeBot.active = !window.game.automation.tradeBot.active;
                window.game.updateAutomationTab();
                const button = event.target;
                button.textContent = window.game.automation.tradeBot.active ? 'Aktywny' : 'Nieaktywny';
                button.classList.toggle('active', window.game.automation.tradeBot.active);
            }
        }

        function toggleExpansionAI() {
            if (window.game) {
                window.game.automation.expansionAI.active = !window.game.automation.expansionAI.active;
                window.game.updateAutomationTab();
                const button = event.target;
                button.textContent = window.game.automation.expansionAI.active ? 'Aktywny' : 'Nieaktywny';
                button.classList.toggle('active', window.game.automation.expansionAI.active);
            }
        }

        function openTradeDialog(from, to) {
            if (window.game) {
                window.game.openTradeDialog(from, to);
            }
        }

        function saveGame() {
            if (window.game) {
                window.game.saveGame();
            }
        }

        function resetGame() {
            if (window.game) {
                window.game.resetGame();
            }
        }

        function exportData() {
            if (window.game) {
                window.game.exportData();
            }
        }
        function toggleResourceBarExtra() {
			const extra = document.querySelector('.resource-bar-extra');
			if (!extra) return;
			extra.style.display = (extra.style.display === "none" || !extra.style.display) ? "grid" : "none";
		}
		// UI Functions for Achievement System
            function showCustomModal(message, btnLabel = "OK") {
			  // Tworzy modal HTML je≈õli nie istnieje
			  let modal = document.getElementById('custom-modal');
			  if (!modal) {
				modal = document.createElement('div');
				modal.id = 'custom-modal';
				modal.innerHTML = `
				  <div class="modal-overlay"></div>
				  <div class="modal-box">
					<div class="modal-message" id="modal-message"></div>
					<button id="modal-ok" class="modal-btn">${btnLabel}</button>
				  </div>
				`;
				document.body.appendChild(modal);
				document.getElementById('modal-ok').onclick = closeCustomModal;
			  }
			  document.getElementById('modal-message').innerText = message;
			  modal.style.display = "flex";
			}

			function closeCustomModal() {
			  let modal = document.getElementById('custom-modal');
			  if (modal) modal.style.display = "none";
			}

function openAchievementPanel() {
    const panel = document.getElementById('achievement-panel');
    if (panel) {
        panel.classList.add('show');
        updateAchievementDisplay();
    }
}

function closeAchievementPanel() {
    const panel = document.getElementById('achievement-panel');
    if (panel) {
        panel.classList.remove('show');
    }
}

function updateAchievementDisplay() {
    const grid = document.getElementById('achievement-grid');
    const summary = document.getElementById('achievement-summary');
    const progressText = document.getElementById('achievement-progress-text');

    if (!grid || !window.game) return;

    const unlockedCount = Object.values(window.game.achievements || {}).filter(a => a.unlocked).length;
    const totalCount = Object.keys(ACHIEVEMENTS).length;
    const percentage = Math.round((unlockedCount / totalCount) * 100);

    // Update summary text
    if (summary) {
        summary.textContent = `Postƒôp: ${unlockedCount} z ${totalCount} osiƒÖgniƒôƒá (${percentage}%)`;
    }

    if (progressText) {
        progressText.textContent = `OsiƒÖgniƒôcia: ${unlockedCount}/${totalCount} (${percentage}%)`;
    }

    // Clear and rebuild grid
    grid.innerHTML = '';

    const activeFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';

    Object.values(ACHIEVEMENTS).forEach(achievement => {
        const gameAchievement = window.game.achievements?.[achievement.id] || achievement;

        // Apply filter
        if (activeFilter !== 'all') {
            if (activeFilter === 'unlocked' && !gameAchievement.unlocked) return;
            if (activeFilter !== 'unlocked' && achievement.tier !== activeFilter) return;
        }

        const item = createAchievementItem(achievement, gameAchievement);
        grid.appendChild(item);
    });

    // Setup filter buttons
    setupFilterButtons();
}

function createAchievementItem(achievement, gameAchievement) {
    const item = document.createElement('div');
    item.className = `achievement-item ${gameAchievement.unlocked ? 'unlocked' : 'locked'}`;

    const rewardText = achievement.reward
        ? `<div class="achievement-reward">Nagroda: ${getRewardDescription(achievement.reward)}</div>`
        : `<div class="achievement-no-reward">Brak nagrody</div>`;

    const progressBar = getProgressBar(achievement, gameAchievement);

    item.innerHTML = `
        <div class="achievement-unlock-indicator">
            ${gameAchievement.unlocked ? '‚úì' : '‚úó'}
        </div>
        <div class="achievement-item-header">
            <div class="achievement-icon">${achievement.icon}</div>
            <div class="achievement-info">
                <div class="achievement-name">${achievement.name}</div>
                <span class="achievement-tier tier-${achievement.tier}">${achievement.tier}</span>
            </div>
        </div>
        <div class="achievement-description">${achievement.description}</div>
        ${rewardText}
        ${progressBar}
    `;

    return item;
}

function getRewardDescription(reward) {
    switch (reward.type) {
        case 'production_bonus':
            return `+${Math.round((reward.multiplier - 1) * 100)}% produkcji ${reward.resource}`;
        case 'cost_reduction':
            return `${Math.round((1 - reward.multiplier) * 100)}% taniej dzia≈Çy`;
        case 'click_power':
            return `+${Math.round((reward.multiplier - 1) * 100)}% si≈Ça klikniƒôƒá`;
        case 'coffee_efficiency':
            return `+${Math.round((reward.multiplier - 1) * 100)}% efektywno≈õƒá kawy`;
        case 'global_expansion_bonus':
            return `+${Math.round((reward.multiplier - 1) * 100)}% bonus ekspansji`;
        default:
            return 'Specjalny bonus';
    }
}

function calculateHumanCapitalEffects(stress, motivation) {
  let production = 1.0;
  let quality = 1.0;

  if (stress < 25) {
    production = 1.0;
    quality = 1.0;
  } else if (stress < 50) {
    production = 0.95;
    quality = 0.9;
  } else if (stress < 75) {
    production = 0.85;
    quality = 0.75;
  } else if (stress < 100) {
    production = 0.7;
    quality = 0.5;
  } else {
    production = Math.max(0.05, 1.0 - (stress - 100) * 0.01);
    quality = Math.max(0.01, 1.0 - (stress - 100) * 0.015);
  }

  let productionBonus = 0;
  if (motivation < 25) productionBonus = -0.25;
  else if (motivation < 50) productionBonus = 0;
  else if (motivation < 75) productionBonus = 0.15;
  else productionBonus = 0.3;

  return {
    production: production + productionBonus,
    quality: quality + productionBonus / 2,
  }
}


function getProgressBar(achievement, gameAchievement) {
    if (gameAchievement.unlocked) return '';

    const progress = calculateAchievementProgress(achievement);
    if (progress === null) return '';

    const percentage = Math.min(100, Math.round(progress * 100));

    return `
        <div class="achievement-progress-bar">
            <div class="achievement-progress-fill" style="width: ${percentage}%"></div>
        </div>
    `;
}
function updateRegionListClean() {
  const regionKeys = ['europe', 'americas', 'asia', 'africa'];
  const regionNames = {
    europe: "Europa",
    americas: "Ameryki",
    asia: "Azja",
    africa: "Afryka"
  };
  const regionFlags = {
    europe: "üá™üá∫",
    americas: "üåé",
    asia: "üåè",
    africa: "üåç"
  };
  let html = '';
  regionKeys.forEach(key => {
    const region = this.regions[key];
    html += `
      <div class="region-row ${region.unlocked ? 'unlocked' : 'locked'}"
        title="${regionNames[key]} ‚Äì bonus: +20% za aktywny ${getDepartmentName(region.keyDepartment)}">
        <span class="region-flag">${regionFlags[key]}</span>
        <span class="region-name">${regionNames[key]}</span>
        <span class="region-info">
          lv.${region.unlocked ? region.level : '?'}${region.unlocked ? '' : ' (zablok.)'}
        </span>
      </div>
    `;
  });
  document.querySelector('.region-list-clean').innerHTML = html;
}
function calculateAchievementProgress(achievement) {
    if (!window.game) return null;

    const req = achievement.requirement;
    const game = window.game;

    switch (req.type) {
        case 'click_count':
            return Math.min(1, (game.gameState?.totalClicks || 0) / req.value);
        case 'resource_max':
            return Math.min(1, (game.resources?.[req.resource] || 0) / req.value);
        case 'department_hired':
            return Math.min(1, (game.departments?.[req.department]?.owned || 0) / req.value);
        case 'coffee_breaks':
            return Math.min(1, (game.gameState?.coffeeBreaks || 0) / req.value);
        case 'stress_peak':
            return Math.min(1, (game.gameState?.maxStress || 0) / req.value);
        case 'motivation_peak':
            return Math.min(1, (game.gameState?.maxMotivation || 0) / req.value);
        default:
            return null;
    }
}

function setupFilterButtons() {
    const buttons = document.querySelectorAll('.filter-btn');
    buttons.forEach(button => {
        button.addEventListener('click', () => {
            buttons.forEach(b => b.classList.remove('active'));
            button.classList.add('active');
            updateAchievementDisplay();
        });
    });
}
// utility:
function getCurrencySymbol(currency) {
  switch(currency) {
    case 'EUR': return '‚Ç¨';
    case 'USD': return '$';
    case 'JPY': return '¬•';
    case 'ZAR': return 'R';
    // inne wg potrzeb
    default: return '';
  }
}
function getRegionFlag(key) {
  switch(key) {
    case 'europe': return 'üá™üá∫';
    case 'americas': return 'üåé';
    case 'asia': return 'üåè';
    case 'africa': return 'üåç';
    case 'middle-east': return 'üïå';
    default: return '';
  }
}
function getRegionName(key) {
  switch(key) {
    case 'europe': return 'Europa';
    case 'americas': return 'Ameryka';
    case 'asia': return 'Azja-Pacyfik';
    case 'africa': return 'Afryka';
    case 'middle-east': return 'Bliski Wsch√≥d';
    default: return '';
  }
}
function getRegionFlag(key) {
    switch(key) {
      case 'europe': return 'üá™üá∫';
      case 'americas': return 'üåé';
      case 'asia': return 'üåè';
      case 'africa': return 'üåç';
      case 'middle-east': return 'üïå';
      default: return '';
    }
}
function getDepartmentName(key) {
   switch(key){
    case 'marketing': return 'Marketing';
    case 'legal': return 'Prawny';
    case 'trade': return 'Handlu';
    case 'rnd': return 'R&D';
    default: return key;
  }
}
function closeCoffeePopup() {
  document.getElementById('coffee-popup').classList.add('hidden');
}
function updateCleanGlobalPresenceList() {
  let html = '';
  // powy≈ºszy blok mo≈ºesz generowaƒá z pƒôtli po kluczach
  // lub bezpo≈õrednio - jak wy≈ºej, je≈õli region√≥w niewiele i majƒÖ sta≈Çe bonusy
  document.querySelector('.region-list-clean').innerHTML = html;
}
function showAchievementNotification(achievement) {
    const container = document.getElementById('achievement-notification-container');
    if (!container) return;

    const notification = document.createElement('div');
    notification.className = 'achievement-notification';

    notification.innerHTML = `
        <div class="achievement-notification-icon">${achievement.icon}</div>
        <div class="achievement-notification-content">
            <div class="achievement-notification-title">OsiƒÖgniƒôcie odblokowane!</div>
            <div class="achievement-notification-desc">${achievement.name}</div>
        </div>
    `;

    container.appendChild(notification);

    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.animation = 'achievement-notification-in 0.3s ease reverse';
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.parentElement.removeChild(notification);
                }
            }, 300);
        }
    }, 5000);
}
document.addEventListener('click', (e) => {
    const panel = document.getElementById('achievement-panel');
    const indicator = document.getElementById('achievement-progress-indicator');

    if (panel && panel.classList.contains('show') &&
        !panel.contains(e.target) &&
        !indicator.contains(e.target)) {
        closeAchievementPanel();
    }
});
        // Initialize game when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM loaded, starting Phase 4.3...');

            try {
                window.game = new CorpoClickerPhase43();
                console.log('üéØ Phase 4.4 game instance created successfully');
            } catch (error) {
                console.error('üí• Critical error during Phase 4.4 initialization:', error);
            }
        });
    </script>
</body>
</html>